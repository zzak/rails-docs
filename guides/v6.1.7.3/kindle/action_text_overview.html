<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Action Text Overview — Ruby on Rails Guides</title>

<link rel="stylesheet" type="text/css" href="stylesheets/kindle.css" />

</head>
<body class="guide">

    <h2>Action Text Overview</h2><p>This guide provides you with all you need to get started in handling
rich text content.</p><p>After reading this guide, you will know:</p>
<ul>
<li>How to configure Action Text.</li>
<li>How to handle rich text content.</li>
<li>How to style rich text content.</li>
</ul>

    <div class="pagebreak"></div>

              <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li><a href="#what-is-action-text-questionmark">What is Action Text?</a></li>
<li><a href="#trix-compared-to-other-rich-text-editors">Trix compared to other rich text editors</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#examples">Examples</a></li>
<li><a href="#avoid-n-1-queries">Avoid N+1 queries</a></li>
<li><a href="#custom-styling">Custom styling</a></li>
<li><a href="#api-backend-development">API / Backend development</a></li>
</ol>

          </div>

    <div class="pagebreak"></div>

  <h3 id="what-is-action-text-questionmark"><a class="anchorlink" href="#what-is-action-text-questionmark">1 What is Action Text?</a></h3><p>Action Text brings rich text content and editing to Rails. It includes
the <a href="https://trix-editor.org">Trix editor</a> that handles everything from formatting
to links to quotes to lists to embedded images and galleries.
The rich text content generated by the Trix editor is saved in its own
RichText model that's associated with any existing Active Record model in the application.
Any embedded images (or other attachments) are automatically stored using
Active Storage and associated with the included RichText model.</p><h3 id="trix-compared-to-other-rich-text-editors"><a class="anchorlink" href="#trix-compared-to-other-rich-text-editors">2 Trix compared to other rich text editors</a></h3><p>Most WYSIWYG editors are wrappers around HTML’s <code>contenteditable</code> and <code>execCommand</code> APIs,
designed by Microsoft to support live editing of web pages in Internet Explorer 5.5,
and <a href="https://blog.whatwg.org/the-road-to-html-5-contenteditable#history">eventually reverse-engineered</a>
and copied by other browsers.</p><p>Because these APIs were never fully specified or documented,
and because WYSIWYG HTML editors are enormous in scope, each
browser's implementation has its own set of bugs and quirks,
and JavaScript developers are left to resolve the inconsistencies.</p><p>Trix sidesteps these inconsistencies by treating contenteditable
as an I/O device: when input makes its way to the editor, Trix converts that input
into an editing operation on its internal document model, then re-renders
that document back into the editor. This gives Trix complete control over what
happens after every keystroke, and avoids the need to use execCommand at all.</p><h3 id="installation"><a class="anchorlink" href="#installation">3 Installation</a></h3><p>Run <code>bin/rails action_text:install</code> to add the Yarn package and copy over the necessary migration. Also, you need to set up Active Storage for embedded images and other attachments. Please refer to the <a href="active_storage_overview.html">Active Storage Overview</a> guide.</p><p>After the installation is complete, a Rails app using Webpacker should have the following changes:</p>
<ol>
<li>
<p>Both <code>trix</code> and <code>@rails/actiontext</code> should be required in your JavaScript pack.</p>
<div class="code_container">
<pre><code class="highlight js"><span class="c1">// application.js</span>
<span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">trix</span><span class="dl">"</span><span class="p">)</span>
<span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@rails/actiontext</span><span class="dl">"</span><span class="p">)</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-f54656066d7d7c2bd6c56c8dfb04d7cb">// application.js
require("trix")
require("@rails/actiontext")
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-f54656066d7d7c2bd6c56c8dfb04d7cb">Copy</button>
</div>
</li>
<li>
<p>The <code>trix</code> stylesheet should be imported into <code>actiontext.scss</code>.</p>
<div class="code_container">
<pre><code class="highlight scss"><span class="k">@import</span> <span class="s2">"trix/dist/trix"</span><span class="p">;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-19326f20ec7bdc2f79aa415b798f8bd5">@import "trix/dist/trix";
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-19326f20ec7bdc2f79aa415b798f8bd5">Copy</button>
</div>
<p>Additionally, this <code>actiontext.scss</code> file should be imported into your stylesheet pack.</p>
<div class="code_container">
<pre><code class="highlight scss"><span class="c1">// application.scss</span>
<span class="k">@import</span> <span class="s2">"./actiontext.scss"</span><span class="p">;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-7569baab8ab7b34e55de298b386ed312">// application.scss
@import "./actiontext.scss";
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-7569baab8ab7b34e55de298b386ed312">Copy</button>
</div>
</li>
</ol>
<h3 id="examples"><a class="anchorlink" href="#examples">4 Examples</a></h3><p>Adding a rich text field to an existing model:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># app/models/message.rb</span>
<span class="k">class</span> <span class="nc">Message</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_rich_text</span> <span class="ss">:content</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-5f78e1ce73c0da0c5a76f08eb648103e"># app/models/message.rb
class Message &lt; ApplicationRecord
  has_rich_text :content
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-5f78e1ce73c0da0c5a76f08eb648103e">Copy</button>
</div>
<p>Note that you don't need to add a <code>content</code> field to your <code>messages</code> table.</p><p>Then refer to this field in the form for the model:</p><div class="code_container">
<pre><code class="highlight erb"><span class="c">&lt;%# app/views/messages/_form.html.erb %&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="n">message</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"field"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:content</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">rich_text_area</span> <span class="ss">:content</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-dc7808e072a63e1fdd084dc476000dfc">&lt;%# app/views/messages/_form.html.erb %&gt;
&lt;%= form_with model: message do |form| %&gt;
  &lt;div class="field"&gt;
    &lt;%= form.label :content %&gt;
    &lt;%= form.rich_text_area :content %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-dc7808e072a63e1fdd084dc476000dfc">Copy</button>
</div>
<p>And finally, display the sanitized rich text on a page:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="vi">@message</span><span class="p">.</span><span class="nf">content</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-08c53799f4daaec68dc7ee66e540d3d0">&lt;%= @message.content %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-08c53799f4daaec68dc7ee66e540d3d0">Copy</button>
</div>
<p>To accept the rich text content, all you have to do is permit the referenced attribute:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">MessagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="n">message</span> <span class="o">=</span> <span class="no">Message</span><span class="p">.</span><span class="nf">create!</span> <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:message</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:content</span><span class="p">)</span>
    <span class="n">redirect_to</span> <span class="n">message</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-d9c820de332d73f39a8fa84f69322bf9">class MessagesController &lt; ApplicationController
  def create
    message = Message.create! params.require(:message).permit(:title, :content)
    redirect_to message
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d9c820de332d73f39a8fa84f69322bf9">Copy</button>
</div>
<h3 id="avoid-n-1-queries"><a class="anchorlink" href="#avoid-n-1-queries">5 Avoid N+1 queries</a></h3><p>If you wish to preload the dependent <code>ActionText::RichText</code> model, assuming your rich text field is named <code>content</code>, you can use the named scope:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Message</span><span class="p">.</span><span class="nf">all</span><span class="p">.</span><span class="nf">with_rich_text_content</span> <span class="c1"># Preload the body without attachments.</span>
<span class="no">Message</span><span class="p">.</span><span class="nf">all</span><span class="p">.</span><span class="nf">with_rich_text_content_and_embeds</span> <span class="c1"># Preload both body and attachments.</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-145efbbe765d863a1cbd8a9007e48917">Message.all.with_rich_text_content # Preload the body without attachments.
Message.all.with_rich_text_content_and_embeds # Preload both body and attachments.
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-145efbbe765d863a1cbd8a9007e48917">Copy</button>
</div>
<h3 id="custom-styling"><a class="anchorlink" href="#custom-styling">6 Custom styling</a></h3><p>By default, the Action Text editor and content is styled by the Trix defaults.
If you want to change these defaults, you'll want to remove
the <code>app/assets/stylesheets/actiontext.scss</code> linker and base your stylings on
the <a href="https://raw.githubusercontent.com/basecamp/trix/master/dist/trix.css">contents of that file</a>.</p><p>You can also style the HTML used for embedded images and other attachments (known as blobs).
On installation, Action Text will copy over a partial to
<code>app/views/active_storage/blobs/_blob.html.erb</code>, which you can specialize.</p><h3 id="api-backend-development"><a class="anchorlink" href="#api-backend-development">7 API / Backend development</a></h3>
<ol>
<li>
<p>A backend API (for example, using JSON) needs a separate endpoint for uploading files that creates an <code>ActiveStorage::Blob</code> and returns its <code>attachable_sgid</code>:</p>
<div class="code_container">
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="nl">"attachable_sgid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BAh7CEkiCG…"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<textarea class="clipboard-content" id="clipboard-1823eaca6d89f2e30f534d9e963a83a1">{
  "attachable_sgid": "BAh7CEkiCG…"
}
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-1823eaca6d89f2e30f534d9e963a83a1">Copy</button>
</div>
</li>
<li>
<p>Take that <code>attachable_sgid</code> and ask your frontend to insert it in rich text content using an <code>&lt;action-text-attachment&gt;</code> tag:</p>
<div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;action-text-attachment</span> <span class="na">sgid=</span><span class="s">"BAh7CEkiCG…"</span><span class="nt">&gt;&lt;/action-text-attachment&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-95b4f8edfa35827702e09c695144eb15">&lt;action-text-attachment sgid="BAh7CEkiCG…"&gt;&lt;/action-text-attachment&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-95b4f8edfa35827702e09c695144eb15">Copy</button>
</div>
</li>
</ol>
<p>This is based on Basecamp, so if you still can't find what you are looking for, check this <a href="https://github.com/basecamp/bc3-api/blob/master/sections/rich_text.md">Basecamp Doc</a>.</p>
</body>
</html>
