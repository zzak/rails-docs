<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>8 Active Record</title>
<link rel="stylesheet" type="text/css" href="/home/rails/v6.0.6.1/guides/output/kindle/stylesheets/kindle.css">
</head>
<body>
<h3 id="active-record"><a class="anchorlink" href="#active-record">8 Active Record</a></h3>
<p>Please refer to the <a href="https://github.com/rails/rails/blob/6-0-stable/activerecord/CHANGELOG.md">Changelog</a> for detailed changes.</p>

<h4 id="active-record-removals"><a class="anchorlink" href="#active-record-removals">8.1 Removals</a></h4>
<ul>
<li>  Remove deprecated <code>#set_state</code> from the transaction object.
(<a href="https://github.com/rails/rails/commit/6c745b0c5152a4437163a67707e02f4464493983">Commit</a>)</li>
<li>  Remove deprecated <code>#supports_statement_cache?</code> from the database adapters.
(<a href="https://github.com/rails/rails/commit/5f3ed8784383fb4eb0f9959f31a9c28a991b7553">Commit</a>)</li>
<li>  Remove deprecated <code>#insert_fixtures</code> from the database adapters.
(<a href="https://github.com/rails/rails/commit/400ba786e1d154448235f5f90183e48a1043eece">Commit</a>)</li>
<li>  Remove deprecated <code>ActiveRecord::ConnectionAdapters::SQLite3Adapter#valid_alter_table_type?</code>.
(<a href="https://github.com/rails/rails/commit/45b4d5f81f0c0ca72c18d0dea4a3a7b2ecc589bf">Commit</a>)</li>
<li>  Remove support for passing the column name to <code>sum</code> when a block is passed.
(<a href="https://github.com/rails/rails/commit/91ddb30083430622188d76eb9f29b78131df67f9">Commit</a>)</li>
<li>  Remove support for passing the column name to <code>count</code> when a block is passed.
(<a href="https://github.com/rails/rails/commit/67356f2034ab41305af7218f7c8b2fee2d614129">Commit</a>)</li>
<li>  Remove support for delegation of missing methods in a relation to arel.
(<a href="https://github.com/rails/rails/commit/d97980a16d76ad190042b4d8578109714e9c53d0">Commit</a>)</li>
<li>  Remove support for delegating missing methods in a relation to private methods of the class.
(<a href="https://github.com/rails/rails/commit/a7becf147afc85c354e5cfa519911a948d25fc4d">Commit</a>)</li>
<li>  Remove support for specifying a timestamp name for <code>#cache_key</code>.
(<a href="https://github.com/rails/rails/commit/0bef23e630f62e38f20b5ae1d1d5dbfb087050ea">Commit</a>)</li>
<li>  Remove deprecated <code>ActiveRecord::Migrator.migrations_path=</code>.
(<a href="https://github.com/rails/rails/commit/90d7842186591cae364fab3320b524e4d31a7d7d">Commit</a>)</li>
<li>  Remove deprecated <code>expand_hash_conditions_for_aggregates</code>.
(<a href="https://github.com/rails/rails/commit/27b252d6a85e300c7236d034d55ec8e44f57a83e">Commit</a>)</li>
</ul>
<h4 id="active-record-deprecations"><a class="anchorlink" href="#active-record-deprecations">8.2 Deprecations</a></h4>
<ul>
<li>  Deprecate mismatched case-sensitivity collation comparisons for uniqueness validator.
(<a href="https://github.com/rails/rails/commit/9def05385f1cfa41924bb93daa187615e88c95b9">Commit</a>)</li>
<li>  Deprecate using class level querying methods if the receiver scope has leaked.
(<a href="https://github.com/rails/rails/pull/35280">Pull Request</a>)</li>
<li>  Deprecate <code>config.active_record.sqlite3.represent_boolean_as_integer</code>.
(<a href="https://github.com/rails/rails/commit/f59b08119bc0c01a00561d38279b124abc82561b">Commit</a>)</li>
<li>  Deprecate passing <code>migrations_paths</code> to <code>connection.assume_migrated_upto_version</code>.
(<a href="https://github.com/rails/rails/commit/c1b14aded27e063ead32fa911aa53163d7cfc21a">Commit</a>)</li>
<li>  Deprecate <code>ActiveRecord::Result#to_hash</code> in favor of <code>ActiveRecord::Result#to_a</code>.
(<a href="https://github.com/rails/rails/commit/16510d609c601aa7d466809f3073ec3313e08937">Commit</a>)</li>
<li>  Deprecate methods in <code>DatabaseLimits</code>: <code>column_name_length</code>, <code>table_name_length</code>,
<code>columns_per_table</code>, <code>indexes_per_table</code>, <code>columns_per_multicolumn_index</code>,
<code>sql_query_length</code>, and <code>joins_per_query</code>.
(<a href="https://github.com/rails/rails/commit/e0a1235f7df0fa193c7e299a5adee88db246b44f">Commit</a>)</li>
<li>  Deprecate <code>update_attributes</code>/<code>!</code> in favor of <code>update</code>/<code>!</code>.
(<a href="https://github.com/rails/rails/commit/5645149d3a27054450bd1130ff5715504638a5f5">Commit</a>)</li>
</ul>
<h4 id="active-record-notable-changes"><a class="anchorlink" href="#active-record-notable-changes">8.3 Notable changes</a></h4>
<ul>
<li>  Bump the minimum sqlite3 version to 1.4.
(<a href="https://github.com/rails/rails/pull/35844">Pull Request</a>)</li>
<li>  Add <code>rails db:prepare</code> to create a database if it doesn't exist, and run its migrations.
(<a href="https://github.com/rails/rails/pull/35768">Pull Request</a>)</li>
<li>  Add <code>after_save_commit</code> callback as shortcut for <code>after_commit :hook, on: [ :create, :update ]</code>.
(<a href="https://github.com/rails/rails/pull/35804">Pull Request</a>)</li>
<li>  Add <code>ActiveRecord::Relation#extract_associated</code> for extracting associated records from a relation.
(<a href="https://github.com/rails/rails/pull/35784">Pull Request</a>)</li>
<li>  Add <code>ActiveRecord::Relation#annotate</code> for adding SQL comments to ActiveRecord::Relation queries.
(<a href="https://github.com/rails/rails/pull/35617">Pull Request</a>)</li>
<li>  Add support for setting Optimizer Hints on databases.
(<a href="https://github.com/rails/rails/pull/35615">Pull Request</a>)</li>
<li>  Add <code>insert_all</code>/<code>insert_all!</code>/<code>upsert_all</code> methods for doing bulk inserts.
(<a href="https://github.com/rails/rails/pull/35631">Pull Request</a>)</li>
<li>  Add <code>rails db:seed:replant</code> that truncates tables of each database
for ther current environment and loads the seeds.
(<a href="https://github.com/rails/rails/pull/34779">Pull Request</a>)</li>
<li>  Add <code>reselect</code> method, which is a short-hand for <code>unscope(:select).select(fields)</code>.
(<a href="https://github.com/rails/rails/pull/33611">Pull Request</a>)</li>
<li>  Add negative scopes for all enum values.
(<a href="https://github.com/rails/rails/pull/35381">Pull Request</a>)</li>
<li>  Add <code>#destroy_by</code> and <code>#delete_by</code> for conditional removals.
(<a href="https://github.com/rails/rails/pull/35316">Pull Request</a>)</li>
<li>  Add the ability to automatically switch database connections.
(<a href="https://github.com/rails/rails/pull/35073">Pull Request</a>)</li>
<li>  Add the ability to prevent writes to a database for the duration of a block.
(<a href="https://github.com/rails/rails/pull/34505">Pull Request</a>)</li>
<li>  Add an API for switching connections to support multiple databases.
(<a href="https://github.com/rails/rails/pull/34052">Pull Request</a>)</li>
<li>  Make timestamps with precision the default for migrations.
(<a href="https://github.com/rails/rails/pull/34970">Pull Request</a>)</li>
<li>  Support <code>:size</code> option to change text and blob size in MySQL.
(<a href="https://github.com/rails/rails/pull/35071">Pull Request</a>)</li>
<li>  Set both the foreign key and the foreign type columns to NULL for
polymorphic associations on <code>dependent: :nullify</code> strategy.
(<a href="https://github.com/rails/rails/pull/28078">Pull Request</a>)</li>
<li>  Allow a permitted instance of <code>ActionController::Parameters</code> to be passed as an
argument to <code>ActiveRecord::Relation#exists?</code>.
(<a href="https://github.com/rails/rails/pull/34891">Pull Request</a>)</li>
<li>  Add support in <code>#where</code> for endless ranges introduced in Ruby 2.6.
(<a href="https://github.com/rails/rails/pull/34906">Pull Request</a>)</li>
<li>  Make <code>ROW_FORMAT=DYNAMIC</code> a default create table option for MySQL.
(<a href="https://github.com/rails/rails/pull/34742">Pull Request</a>)</li>
<li>  Add the ability to disable scopes generated by <code>ActiveRecord.enum</code>.
(<a href="https://github.com/rails/rails/pull/34605/files">Pull Request</a>)</li>
<li>  Make implicit ordering configurable for a column.
(<a href="https://github.com/rails/rails/pull/34480">Pull Request</a>)</li>
<li>  Bump the minimum PostgreSQL version to 9.3, dropping support for 9.1 and 9.2.
(<a href="https://github.com/rails/rails/pull/34520">Pull Request</a>)</li>
<li>  Make the values of an enum frozen, raising an error when attempting to modify them.
(<a href="https://github.com/rails/rails/pull/34517">Pull Request</a>)</li>
<li>  Make the SQL of <code>ActiveRecord::StatementInvalid</code> errors its own error property
and include SQL binds as a separate error property.
(<a href="https://github.com/rails/rails/pull/34468">Pull Request</a>)</li>
<li>  Add an <code>:if_not_exists</code> option to <code>create_table</code>.
(<a href="https://github.com/rails/rails/pull/31382">Pull Request</a>)</li>
<li>  Add support for multiple databases to <code>rails db:schema:cache:dump</code>
and <code>rails db:schema:cache:clear</code>.
(<a href="https://github.com/rails/rails/pull/34181">Pull Request</a>)</li>
<li>  Add support for hash and url configs in database hash of <code>ActiveRecord::Base.connected_to</code>.
(<a href="https://github.com/rails/rails/pull/34196">Pull Request</a>)</li>
<li>  Add support for default expressions and expression indexes for MySQL.
(<a href="https://github.com/rails/rails/pull/34307">Pull Request</a>)</li>
<li>  Add an <code>index</code> option for <code>change_table</code> migration helpers.
(<a href="https://github.com/rails/rails/pull/23593">Pull Request</a>)</li>
<li>  Fix <code>transaction</code> reverting for migrations. Previously, commands inside of a <code>transaction</code>
in a reverted migration ran uninverted. This change fixes that.
(<a href="https://github.com/rails/rails/pull/31604">Pull Request</a>)</li>
<li>  Allow <code>ActiveRecord::Base.configurations=</code> to be set with a symbolized hash.
(<a href="https://github.com/rails/rails/pull/33968">Pull Request</a>)</li>
<li>  Fix the counter cache to only update if the record is actually saved.
(<a href="https://github.com/rails/rails/pull/33913">Pull Request</a>)</li>
<li>  Add expression indexes support for the SQLite adapter.
(<a href="https://github.com/rails/rails/pull/33874">Pull Request</a>)</li>
<li>  Allow subclasses to redefine autosave callbacks for associated records.
(<a href="https://github.com/rails/rails/pull/33378">Pull Request</a>)</li>
<li>  Bump the minimum MySQL version to 5.5.8.
(<a href="https://github.com/rails/rails/pull/33853">Pull Request</a>)</li>
<li>  Use the utf8mb4 character set by default in MySQL.
(<a href="https://github.com/rails/rails/pull/33608">Pull Request</a>)</li>
<li>  Add the ability to filter out sensitive data in <code>#inspect</code>
(<a href="https://github.com/rails/rails/pull/33756">Pull Request</a>, <a href="https://github.com/rails/rails/pull/34208">Pull Request</a>)</li>
<li>  Change <code>ActiveRecord::Base.configurations</code> to return an object instead of a hash.
(<a href="https://github.com/rails/rails/pull/33637">Pull Request</a>)</li>
<li>  Add database configuration to disable advisory locks.
(<a href="https://github.com/rails/rails/pull/33691">Pull Request</a>)</li>
<li>  Update SQLite3 adapter <code>alter_table</code> method to restore foreign keys.
(<a href="https://github.com/rails/rails/pull/33585">Pull Request</a>)</li>
<li>  Allow the <code>:to_table</code> option of <code>remove_foreign_key</code> to be invertible.
(<a href="https://github.com/rails/rails/pull/33530">Pull Request</a>)</li>
<li>  Fix default value for mysql time types with specified precision.
(<a href="https://github.com/rails/rails/pull/33280">Pull Request</a>)</li>
<li>  Fix the <code>touch</code> option to behave consistently with <code>Persistence#touch</code> method.
(<a href="https://github.com/rails/rails/pull/33107">Pull Request</a>)</li>
<li>  Raise an exception for duplicate column definitions in Migrations.
(<a href="https://github.com/rails/rails/pull/33029">Pull Request</a>)</li>
<li>  Bump the minimum SQLite version to 3.8.
(<a href="https://github.com/rails/rails/pull/32923">Pull Request</a>)</li>
<li>  Fix parent records to not get saved with duplicate children records.
(<a href="https://github.com/rails/rails/pull/32952">Pull Request</a>)</li>
<li>  Ensure <code>Associations::CollectionAssociation#size</code> and <code>Associations::CollectionAssociation#empty?</code>
use loaded association ids if present.
(<a href="https://github.com/rails/rails/pull/32617">Pull Request</a>)</li>
<li>  Add support to preload associations of polymorphic associations when not all the records have the requested associations.
(<a href="https://github.com/rails/rails/commit/75ef18c67c29b1b51314b6c8a963cee53394080b">Commit</a>)</li>
<li>  Add <code>touch_all</code> method to <code>ActiveRecord::Relation</code>.
(<a href="https://github.com/rails/rails/pull/31513">Pull Request</a>)</li>
<li>  Add <code>ActiveRecord::Base.base_class?</code> predicate.
(<a href="https://github.com/rails/rails/pull/32417">Pull Request</a>)</li>
<li>  Add custom prefix/suffix options to <code>ActiveRecord::Store.store_accessor</code>.
(<a href="https://github.com/rails/rails/pull/32306">Pull Request</a>)</li>
<li>  Add <code>ActiveRecord::Base.create_or_find_by</code>/<code>!</code> to deal with the SELECT/INSERT race condition in
<code>ActiveRecord::Base.find_or_create_by</code>/<code>!</code> by leaning on unique constraints in the database.
(<a href="https://github.com/rails/rails/pull/31989">Pull Request</a>)</li>
<li>  Add <code>Relation#pick</code> as short-hand for single-value plucks.
(<a href="https://github.com/rails/rails/pull/31941">Pull Request</a>)</li>
</ul>
</body>
</html>
