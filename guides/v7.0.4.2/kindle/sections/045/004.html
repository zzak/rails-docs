<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>5 Contributing to the Rails Code</title>
<link rel="stylesheet" type="text/css" href="/home/rails/v7.0.4.2/guides/output/kindle/stylesheets/kindle.css">
</head>
<body>
<h3 id="contributing-to-the-rails-code"><a class="anchorlink" href="#contributing-to-the-rails-code">5 Contributing to the Rails Code</a></h3>
<h4 id="setting-up-a-development-environment"><a class="anchorlink" href="#setting-up-a-development-environment">5.1 Setting Up a Development Environment</a></h4>

<p>To move on from submitting bugs to helping resolve existing issues or contributing your own code to Ruby on Rails, you <em>must</em> be able to run its test suite. In this section of the guide, you'll learn how to set up the tests on your computer.</p>

<h5 id="the-easiest-way"><a class="anchorlink" href="#the-easiest-way">5.1.1 The Easiest Way</a></h5>

<p>Start a GitHub Codespace from the repository and start developing right away from the browser IDE or in your local VScode. The Codespace is initialized with all required dependencies and allows you to run all tests.</p>

<h5 id="the-easy-way"><a class="anchorlink" href="#the-easy-way">5.1.2 The Easy Way</a></h5>

<p>The easiest and recommended way to get a development environment ready to hack is to use the <a href="https://github.com/rails/rails-dev-box">rails-dev-box</a>.</p>

<h5 id="the-hard-way"><a class="anchorlink" href="#the-hard-way">5.1.3 The Hard Way</a></h5>

<p>In case you can't use the Rails development box, see <a href="development_dependencies_install.html">this other guide</a>.</p>

<h4 id="clone-the-rails-repository"><a class="anchorlink" href="#clone-the-rails-repository">5.2 Clone the Rails Repository</a></h4>

<p>To be able to contribute code, you need to clone the Rails repository:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">git </span>clone https://github.com/rails/rails.git
</code></pre>
<button class="clipboard-button" data-clipboard-text="git clone https://github.com/rails/rails.git
">Copy</button>
</div>
<p>and create a dedicated branch:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">cd rails</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">git </span>checkout <span class="nt">-b</span> my_new_branch
</code></pre>
<button class="clipboard-button" data-clipboard-text="cd rails
git checkout -b my_new_branch
">Copy</button>
</div>
<p>It doesn't matter much what name you use because this branch will only exist on your local computer and your personal repository on GitHub. It won't be part of the Rails Git repository.</p>

<h4 id="bundle-install"><a class="anchorlink" href="#bundle-install">5.3 Bundle install</a></h4>

<p>Install the required gems.</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bundle install</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="bundle install
">Copy</button>
</div>
<h4 id="running-an-application-against-your-local-branch"><a class="anchorlink" href="#running-an-application-against-your-local-branch">5.4 Running an Application Against Your Local Branch</a></h4>

<p>In case you need a dummy Rails app to test changes, the <code>--dev</code> flag of <code>rails new</code> generates an application that uses your local branch:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">cd rails</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">bundle exec rails </span>new ~/my-test-app <span class="nt">--dev</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="cd rails
bundle exec rails new ~/my-test-app --dev
">Copy</button>
</div>
<p>The application generated in <code>~/my-test-app</code> runs against your local branch
and, in particular, sees any modifications upon server reboot.</p>

<p>For JavaScript packages, you can use <a href="https://yarnpkg.com/cli/link"><code>yarn link</code></a> to source your local branch in a generated application:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">cd rails</span>/activestorage
<span class="gp">$</span><span class="w"> </span><span class="nb">yarn link</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">cd</span> ~/my-test-app
<span class="gp">$</span><span class="w"> </span><span class="nb">yarn link</span> <span class="s2">"@rails/activestorage"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='cd rails/activestorage
yarn link
cd ~/my-test-app
yarn link "@rails/activestorage"
'>Copy</button>
</div>
<h4 id="write-your-code"><a class="anchorlink" href="#write-your-code">5.5 Write Your Code</a></h4>

<p>Now get busy and add/edit code. You're on your branch now, so you can write whatever you want (make sure you're on the right branch with <code>git branch -a</code>). But if you're planning to submit your change back for inclusion in Rails, keep a few things in mind:</p>
<ul>
<li>Get the code right.</li>
<li>Use Rails idioms and helpers.</li>
<li>Include tests that fail without your code, and pass with it.</li>
<li>Update the (surrounding) documentation, examples elsewhere, and the guides: whatever is affected by your contribution.</li>
</ul>
<div class="info"><p>Changes that are cosmetic and do not add anything substantial to the stability, functionality, or testability of Rails will generally not be accepted (read more about <a href="https://github.com/rails/rails/pull/13771#issuecomment-32746700">our rationales behind this decision</a>).</p></div>

<h5 id="follow-the-coding-conventions"><a class="anchorlink" href="#follow-the-coding-conventions">5.5.1 Follow the Coding Conventions</a></h5>

<p>Rails follows a simple set of coding style conventions:</p>
<ul>
<li>Two spaces, no tabs (for indentation).</li>
<li>No trailing whitespace. Blank lines should not have any spaces.</li>
<li>Indent and no blank line after private/protected.</li>
<li>Use Ruby &gt;= 1.9 syntax for hashes. Prefer <code>{ a: :b }</code> over <code>{ :a =&gt; :b }</code>.</li>
<li>Prefer <code>&amp;&amp;</code>/<code>||</code> over <code>and</code>/<code>or</code>.</li>
<li>Prefer <code>class &lt;&lt; self</code> over <code>self.method</code> for class methods.</li>
<li>Use <code>my_method(my_arg)</code> not <code>my_method( my_arg )</code> or <code>my_method my_arg</code>.</li>
<li>Use <code>a = b</code> and not <code>a=b</code>.</li>
<li>Use <code>assert_not</code> methods instead of <code>refute</code>.</li>
<li>Prefer <code>method { do_stuff }</code> instead of <code>method{do_stuff}</code> for single-line blocks.</li>
<li>Follow the conventions in the source you see used already.</li>
</ul>
<p>The above are guidelines - please use your best judgment in using them.</p>

<p>Additionally, we have <a href="https://www.rubocop.org/">RuboCop</a> rules defined to codify some of our coding conventions. You can run RuboCop locally against the file that you have modified before submitting a pull request:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bundle exec </span>rubocop actionpack/lib/action_controller/metal/strong_parameters.rb
<span class="go">Inspecting 1 file
</span><span class="c">.
</span><span class="go">
1 file inspected, no offenses detected
</span></code></pre>
<button class="clipboard-button" data-clipboard-text="bundle exec rubocop actionpack/lib/action_controller/metal/strong_parameters.rb
">Copy</button>
</div>
<p>For <code>rails-ujs</code> CoffeeScript and JavaScript files, you can run <code>npm run lint</code> in <code>actionview</code> folder.</p>

<h5 id="spell-checking"><a class="anchorlink" href="#spell-checking">5.5.2 Spell Checking</a></h5>

<p>We are running <a href="https://github.com/client9/misspell">misspell</a> which is mainly written in
<a href="https://golang.org/">Golang</a> to check spelling with <a href="https://github.com/rails/rails/blob/main/.github/workflows/lint.yml">GitHub Actions</a>. Correct
commonly misspelled English words quickly with <code>misspell</code>. <code>misspell</code> is different from most other spell checkers
because it doesn't use a custom dictionary. You can run <code>misspell</code> locally against all files with:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="go">find . -type f | xargs ./misspell -i 'aircrafts,devels,invertions' -error
</span></code></pre>
<button class="clipboard-button" data-clipboard-text="">Copy</button>
</div>
<p>Notable <code>misspell</code> help options or flags are:</p>
<ul>
<li>
<code>-i</code> string: ignore the following corrections, comma separated</li>
<li>
<code>-w</code>: Overwrite file with corrections (default is just to display)</li>
</ul>
<p>We also run <a href="https://github.com/codespell-project/codespell">codespell</a> with GitHub Actions to check spelling and
<a href="https://pypi.org/project/codespell/">codespell</a> runs against a <a href="https://github.com/rails/rails/blob/main/codespell.txt">small custom dictionary</a>.
<code>codespell</code> is written in <a href="https://www.python.org/">Python</a> and you can run it with:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="go">codespell --ignore-words=codespell.txt
</span></code></pre>
<button class="clipboard-button" data-clipboard-text="">Copy</button>
</div>
<h4 id="benchmark-your-code"><a class="anchorlink" href="#benchmark-your-code">5.6 Benchmark Your Code</a></h4>

<p>For changes that might have an impact on performance, please benchmark your
code and measure the impact. Please share the benchmark script you used as well
as the results. You should consider including this information in your commit
message, to allow future contributors to easily verify your findings and
determine if they are still relevant. (For example, future optimizations in the
Ruby VM might render certain optimizations unnecessary.)</p>

<p>When optimizing for a specific scenario that you care about, it is easy to
regress performance for other common cases.
Therefore, you should test your change against a list of representative
scenarios, ideally extracted from real-world production applications.</p>

<p>You can use the <a href="https://github.com/rails/rails/blob/main/guides/bug_report_templates/benchmark.rb">benchmark template</a>
as a starting point. It includes the boilerplate code to set up a benchmark
using the <a href="https://github.com/evanphx/benchmark-ips">benchmark-ips</a> gem. The
template is designed for testing relatively self-contained changes that can be
inlined into the script.</p>

<h4 id="running-tests"><a class="anchorlink" href="#running-tests">5.7 Running Tests</a></h4>

<p>It is not customary in Rails to run the full test suite before pushing
changes. The railties test suite, in particular, takes a long time, and will take an
especially long time if the source code is mounted in <code>/vagrant</code> as happens in
the recommended workflow with the <a href="https://github.com/rails/rails-dev-box">rails-dev-box</a>.</p>

<p>As a compromise, test what your code obviously affects, and if the change is
not in railties, run the whole test suite of the affected component. If all
tests are passing, that's enough to propose your contribution. We have
<a href="https://buildkite.com/rails/rails">Buildkite</a> as a safety net for catching
unexpected breakages elsewhere.</p>

<h5 id="entire-rails"><a class="anchorlink" href="#entire-rails">5.7.1 Entire Rails:</a></h5>

<p>To run all the tests, do:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">cd rails</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">bundle exec rake test</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="cd rails
bundle exec rake test
">Copy</button>
</div>
<h5 id="for-a-particular-component"><a class="anchorlink" href="#for-a-particular-component">5.7.2 For a Particular Component</a></h5>

<p>You can run tests only for a particular component (e.g., Action Pack). For example,
to run Action Mailer tests:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>actionmailer
<span class="gp">$</span><span class="w"> </span>bin/test
</code></pre>
<button class="clipboard-button" data-clipboard-text="cd actionmailer
bin/test
">Copy</button>
</div>
<h5 id="for-a-specific-directory"><a class="anchorlink" href="#for-a-specific-directory">5.7.3 For a Specific Directory</a></h5>

<p>You can run tests only for a specific directory of a particular component
(e.g., models in Active Storage). For example, to run tests in <code>/activestorage/test/models</code>:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>activestorage
<span class="gp">$</span><span class="w"> </span>bin/test models
</code></pre>
<button class="clipboard-button" data-clipboard-text="cd activestorage
bin/test models
">Copy</button>
</div>
<h5 id="for-a-specific-file"><a class="anchorlink" href="#for-a-specific-file">5.7.4 For a Specific File</a></h5>

<p>You can run the tests for a particular file:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>actionview
<span class="gp">$</span><span class="w"> </span>bin/test <span class="nb">test</span>/template/form_helper_test.rb
</code></pre>
<button class="clipboard-button" data-clipboard-text="cd actionview
bin/test test/template/form_helper_test.rb
">Copy</button>
</div>
<h5 id="running-a-single-test"><a class="anchorlink" href="#running-a-single-test">5.7.5 Running a Single Test</a></h5>

<p>You can run a single test by name using the <code>-n</code> option:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>actionmailer
<span class="gp">$</span><span class="w"> </span>bin/test <span class="nb">test</span>/mail_layout_test.rb <span class="nt">-n</span> test_explicit_class_layout
</code></pre>
<button class="clipboard-button" data-clipboard-text="cd actionmailer
bin/test test/mail_layout_test.rb -n test_explicit_class_layout
">Copy</button>
</div>
<h5 id="running-tests-with-a-specific-seed"><a class="anchorlink" href="#running-tests-with-a-specific-seed">5.7.6 Running Tests with a Specific Seed</a></h5>

<p>Test execution is randomized with a randomization seed. If you are experiencing random
test failures, you can more accurately reproduce a failing test scenario by specifically
setting the randomization seed.</p>

<p>Running all tests for a component:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>actionmailer
<span class="gp">$</span><span class="w"> </span><span class="nv">SEED</span><span class="o">=</span>15002 bin/test
</code></pre>
<button class="clipboard-button" data-clipboard-text="cd actionmailer
SEED=15002 bin/test
">Copy</button>
</div>
<p>Running a single test file:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>actionmailer
<span class="gp">$</span><span class="w"> </span><span class="nv">SEED</span><span class="o">=</span>15002 bin/test <span class="nb">test</span>/mail_layout_test.rb
</code></pre>
<button class="clipboard-button" data-clipboard-text="cd actionmailer
SEED=15002 bin/test test/mail_layout_test.rb
">Copy</button>
</div>
<h5 id="running-tests-in-serial"><a class="anchorlink" href="#running-tests-in-serial">5.7.7 Running Tests in Serial</a></h5>

<p>Action Pack and Action View unit tests run in parallel by default. If you are experiencing random
test failures, you can set the randomization seed and let these unit tests run in serial by setting <code>PARALLEL_WORKERS=1</code></p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>actionview
<span class="gp">$</span><span class="w"> </span><span class="nv">PARALLEL_WORKERS</span><span class="o">=</span>1 <span class="nv">SEED</span><span class="o">=</span>53708 bin/test <span class="nb">test</span>/template/test_case_test.rb
</code></pre>
<button class="clipboard-button" data-clipboard-text="cd actionview
PARALLEL_WORKERS=1 SEED=53708 bin/test test/template/test_case_test.rb
">Copy</button>
</div>
<h5 id="testing-active-record"><a class="anchorlink" href="#testing-active-record">5.7.8 Testing Active Record</a></h5>

<p>First, create the databases you'll need. You can find a list of the required
table names, usernames, and passwords in <code>activerecord/test/config.example.yml</code>.</p>

<p>For MySQL and PostgreSQL, it is sufficient to run:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>activerecord
<span class="gp">$</span><span class="w"> </span><span class="nb">bundle exec rake </span>db:mysql:build
</code></pre>
<button class="clipboard-button" data-clipboard-text="cd activerecord
bundle exec rake db:mysql:build
">Copy</button>
</div>
<p>Or:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>activerecord
<span class="gp">$</span><span class="w"> </span><span class="nb">bundle exec rake </span>db:postgresql:build
</code></pre>
<button class="clipboard-button" data-clipboard-text="cd activerecord
bundle exec rake db:postgresql:build
">Copy</button>
</div>
<p>This is not necessary for SQLite3.</p>

<p>This is how you run the Active Record test suite only for SQLite3:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>activerecord
<span class="gp">$</span><span class="w"> </span><span class="nb">bundle exec rake test</span>:sqlite3
</code></pre>
<button class="clipboard-button" data-clipboard-text="cd activerecord
bundle exec rake test:sqlite3
">Copy</button>
</div>
<p>You can now run the tests as you did for <code>sqlite3</code>. The tasks are respectively:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bundle exec rake test</span>:mysql2
<span class="gp">$</span><span class="w"> </span><span class="nb">bundle exec rake test</span>:postgresql
</code></pre>
<button class="clipboard-button" data-clipboard-text="bundle exec rake test:mysql2
bundle exec rake test:postgresql
">Copy</button>
</div>
<p>Finally,</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bundle exec rake test</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="bundle exec rake test
">Copy</button>
</div>
<p>will now run the three of them in turn.</p>

<p>You can also run any single test separately:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nv">ARCONN</span><span class="o">=</span><span class="nb">sqlite3 bundle exec ruby</span> <span class="nt">-Itest</span> <span class="nb">test</span>/cases/associations/has_many_associations_test.rb
</code></pre>
<button class="clipboard-button" data-clipboard-text="ARCONN=sqlite3 bundle exec ruby -Itest test/cases/associations/has_many_associations_test.rb
">Copy</button>
</div>
<p>To run a single test against all adapters, use:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bundle exec rake </span><span class="nv">TEST</span><span class="o">=</span><span class="nb">test</span>/cases/associations/has_many_associations_test.rb
</code></pre>
<button class="clipboard-button" data-clipboard-text="bundle exec rake TEST=test/cases/associations/has_many_associations_test.rb
">Copy</button>
</div>
<p>You can invoke <code>test_jdbcmysql</code>, <code>test_jdbcsqlite3</code> or <code>test_jdbcpostgresql</code> also. See the file <code>activerecord/RUNNING_UNIT_TESTS.rdoc</code> for information on running more targeted database tests.</p>

<h4 id="warnings"><a class="anchorlink" href="#warnings">5.8 Warnings</a></h4>

<p>The test suite runs with warnings enabled. Ideally, Ruby on Rails should issue no warnings, but there may be a few, as well as some from third-party libraries. Please ignore (or fix!) them, if any, and submit patches that do not issue new warnings.</p>

<h4 id="updating-the-documentation"><a class="anchorlink" href="#updating-the-documentation">5.9 Updating the Documentation</a></h4>

<p>The Ruby on Rails <a href="https://guides.rubyonrails.org/">guides</a> provide a high-level overview of Rails' features, while the <a href="https://api.rubyonrails.org/v7.0.4.2/">API documentation</a> delves into specifics.</p>

<p>If your PR adds a new feature, or changes how an existing feature behaves, check the relevant documentation, and update it or add to it as necessary.</p>

<p>For example, if you modify Active Storage's image analyzer to add a new metadata field, you should update the <a href="https://edgeguides.rubyonrails.org/active_storage_overview.html#analyzing-files">Analyzing Files</a> section of the Active Storage guide to reflect that.</p>

<h4 id="updating-the-changelog"><a class="anchorlink" href="#updating-the-changelog">5.10 Updating the CHANGELOG</a></h4>

<p>The CHANGELOG is an important part of every release. It keeps the list of changes for every Rails version.</p>

<p>You should add an entry <strong>to the top</strong> of the CHANGELOG of the framework you modified if you're adding or removing a feature, committing a bug fix, or adding deprecation notices. Refactorings and documentation changes generally should not go to the CHANGELOG.</p>

<p>A CHANGELOG entry should summarize what was changed and should end with the author's name. You can use multiple lines if you need more space, and you can attach code examples indented with 4 spaces. If a change is related to a specific issue, you should attach the issue's number. Here is an example CHANGELOG entry:</p>

<div class="code_container">
<pre><code class="highlight plaintext">*   Summary of a change that briefly describes what was changed. You can use multiple
    lines and wrap them at around 80 characters. Code examples are ok, too, if needed:

        class Foo
          def bar
            puts 'baz'
          end
        end

    You can continue after the code example, and you can attach the issue number.

    Fixes #1234.

    *Your Name*
</code></pre>
<button class="clipboard-button" data-clipboard-text="*   Summary of a change that briefly describes what was changed. You can use multiple
    lines and wrap them at around 80 characters. Code examples are ok, too, if needed:

        class Foo
          def bar
            puts 'baz'
          end
        end

    You can continue after the code example, and you can attach the issue number.

    Fixes #1234.

    *Your Name*
">Copy</button>
</div>
<p>Your name can be added directly after the last word if there are no code
examples or multiple paragraphs. Otherwise, it's best to make a new paragraph.</p>

<h4 id="ignoring-files-created-by-your-editor-ide"><a class="anchorlink" href="#ignoring-files-created-by-your-editor-ide">5.11 Ignoring Files Created by Your Editor / IDE</a></h4>

<p>Some editors and IDEs will create hidden files or folders inside the <code>rails</code> folder. Instead of manually excluding those from each commit or adding them to Rails' <code>.gitignore</code>, you should add them to your own <a href="https://docs.github.com/en/get-started/getting-started-with-git/ignoring-files#configuring-ignored-files-for-all-repositories-on-your-computer">global gitignore file</a>.</p>

<h4 id="updating-the-gemfile-lock"><a class="anchorlink" href="#updating-the-gemfile-lock">5.12 Updating the Gemfile.lock</a></h4>

<p>Some changes require dependency upgrades. In these cases, make sure you run <code>bundle update</code> to get the correct version of the dependency and commit the <code>Gemfile.lock</code> file within your changes.</p>

<h4 id="commit-your-changes"><a class="anchorlink" href="#commit-your-changes">5.13 Commit Your Changes</a></h4>

<p>When you're happy with the code on your computer, you need to commit the changes to Git:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">git </span>commit <span class="nt">-a</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="git commit -a
">Copy</button>
</div>
<p>This should fire up your editor to write a commit message. When you have
finished, save, and close to continue.</p>

<p>A well-formatted and descriptive commit message is very helpful to others for
understanding why the change was made, so please take the time to write it.</p>

<p>A good commit message looks like this:</p>

<div class="code_container">
<pre><code class="highlight plaintext">Short summary (ideally 50 characters or less)

More detailed description, if necessary. Each line should wrap at
72 characters. Try to be as descriptive as you can. Even if you
think that the commit content is obvious, it may not be obvious
to others. Add any description that is already present in the
relevant issues; it should not be necessary to visit a webpage
to check the history.

The description section can have multiple paragraphs.

Code examples can be embedded by indenting them with 4 spaces:

    class ArticlesController
      def index
        render json: Article.limit(10)
      end
    end

You can also add bullet points:

- make a bullet point by starting a line with either a dash (-)
  or an asterisk (*)

- wrap lines at 72 characters, and indent any additional lines
  with 2 spaces for readability
</code></pre>
<button class="clipboard-button" data-clipboard-text="Short summary (ideally 50 characters or less)

More detailed description, if necessary. Each line should wrap at
72 characters. Try to be as descriptive as you can. Even if you
think that the commit content is obvious, it may not be obvious
to others. Add any description that is already present in the
relevant issues; it should not be necessary to visit a webpage
to check the history.

The description section can have multiple paragraphs.

Code examples can be embedded by indenting them with 4 spaces:

    class ArticlesController
      def index
        render json: Article.limit(10)
      end
    end

You can also add bullet points:

- make a bullet point by starting a line with either a dash (-)
  or an asterisk (*)

- wrap lines at 72 characters, and indent any additional lines
  with 2 spaces for readability
">Copy</button>
</div>
<div class="info"><p>Please squash your commits into a single commit when appropriate. This
simplifies future cherry picks and keeps the git log clean.</p></div>

<h4 id="update-your-branch"><a class="anchorlink" href="#update-your-branch">5.14 Update Your Branch</a></h4>

<p>It's pretty likely that other changes to main have happened while you were working. Go get them:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">git </span>checkout main
<span class="gp">$</span><span class="w"> </span><span class="nb">git </span>pull <span class="nt">--rebase</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="git checkout main
git pull --rebase
">Copy</button>
</div>
<p>Now reapply your patch on top of the latest changes:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">git </span>checkout my_new_branch
<span class="gp">$</span><span class="w"> </span><span class="nb">git </span>rebase main
</code></pre>
<button class="clipboard-button" data-clipboard-text="git checkout my_new_branch
git rebase main
">Copy</button>
</div>
<p>No conflicts? Tests still pass? Change still seems reasonable to you? Then move on.</p>

<h4 id="fork"><a class="anchorlink" href="#fork">5.15 Fork</a></h4>

<p>Navigate to the Rails <a href="https://github.com/rails/rails">GitHub repository</a> and press "Fork" in the upper right-hand corner.</p>

<p>Add the new remote to your local repository on your local machine:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">git </span>remote add fork https://github.com/&lt;your username&gt;/rails.git
</code></pre>
<button class="clipboard-button" data-clipboard-text="git remote add fork https://github.com/&lt;your username&gt;/rails.git
">Copy</button>
</div>
<p>You may have cloned your local repository from rails/rails, or you may have cloned from your forked repository. The following git commands assume that you have made a "rails" remote that points to rails/rails.</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">git </span>remote add <span class="nb">rails </span>https://github.com/rails/rails.git
</code></pre>
<button class="clipboard-button" data-clipboard-text="git remote add rails https://github.com/rails/rails.git
">Copy</button>
</div>
<p>Download new commits and branches from the official repository:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">git </span>fetch <span class="nb">rails</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="git fetch rails
">Copy</button>
</div>
<p>Merge the new content:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">git </span>checkout main
<span class="gp">$</span><span class="w"> </span><span class="nb">git </span>rebase <span class="nb">rails</span>/main
<span class="gp">$</span><span class="w"> </span><span class="nb">git </span>checkout my_new_branch
<span class="gp">$</span><span class="w"> </span><span class="nb">git </span>rebase <span class="nb">rails</span>/main
</code></pre>
<button class="clipboard-button" data-clipboard-text="git checkout main
git rebase rails/main
git checkout my_new_branch
git rebase rails/main
">Copy</button>
</div>
<p>Update your fork:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">git </span>push fork main
<span class="gp">$</span><span class="w"> </span><span class="nb">git </span>push fork my_new_branch
</code></pre>
<button class="clipboard-button" data-clipboard-text="git push fork main
git push fork my_new_branch
">Copy</button>
</div>
<h4 id="issue-a-pull-request"><a class="anchorlink" href="#issue-a-pull-request">5.16 Issue a Pull Request</a></h4>

<p>Navigate to the Rails repository you just pushed to (e.g.
<a href="https://github.com/your-user-name/rails">https://github.com/your-user-name/rails</a>) and click on "Pull Requests" in the top bar (just above the code).
On the next page, click "New pull request" in the upper right-hand corner.</p>

<p>The pull request should target the base repository <code>rails/rails</code> and the branch <code>main</code>.
The head repository will be your work (<code>your-user-name/rails</code>), and the branch will be
whatever name you gave your branch. Click "create pull request" when you're ready.</p>

<p>Ensure the changesets you introduced are included. Fill in some details about
your potential patch, using the pull request template provided. When finished, click "Create
pull request". The Rails core team will be notified about your submission.</p>

<h4 id="get-some-feedback"><a class="anchorlink" href="#get-some-feedback">5.17 Get some Feedback</a></h4>

<p>Most pull requests will go through a few iterations before they get merged.
Different contributors will sometimes have different opinions, and often
patches will need to be revised before they can get merged.</p>

<p>Some contributors to Rails have email notifications from GitHub turned on, but
others do not. Furthermore, (almost) everyone who works on Rails is a
volunteer, and so it may take a few days for you to get your first feedback on
a pull request. Don't despair! Sometimes it's quick; sometimes it's slow. Such
is the open source life.</p>

<p>If it's been over a week, and you haven't heard anything, you might want to try
and nudge things along. You can use the <a href="https://discuss.rubyonrails.org/c/rubyonrails-core">rubyonrails-core mailing
list</a> for this. You can also
leave another comment on the pull request.</p>

<p>While you're waiting for feedback on your pull request, open up a few other
pull requests and give someone else some! They'll appreciate it in
the same way that you appreciate feedback on your patches.</p>

<p>Note that your pull request may be marked as "Approved" by somebody who does not
have access to merge it. Further changes may still be required before members of
the core or committer teams accept it. To prevent confusion, when giving
feedback on someone else's pull request, please avoid marking it as "Approved."</p>

<h4 id="iterate-as-necessary"><a class="anchorlink" href="#iterate-as-necessary">5.18 Iterate as Necessary</a></h4>

<p>It's entirely possible that the feedback you get will suggest changes. Don't get discouraged: the whole point of contributing to an active open source project is to tap into the community's knowledge. If people encourage you to tweak your code, then it's worth making the tweaks and resubmitting. If the feedback is that your code doesn't belong in the core, you might still think about releasing it as a gem.</p>

<h5 id="squashing-commits"><a class="anchorlink" href="#squashing-commits">5.18.1 Squashing Commits</a></h5>

<p>One of the things that we may ask you to do is to "squash your commits", which
will combine all of your commits into a single commit. We prefer pull requests
that are a single commit. This makes it easier to backport changes to stable
branches, squashing makes it easier to revert bad commits, and the git history
can be a bit easier to follow. Rails is a large project, and a bunch of
extraneous commits can add a lot of noise.</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">git </span>fetch <span class="nb">rails</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">git </span>checkout my_new_branch
<span class="gp">$</span><span class="w"> </span><span class="nb">git </span>rebase <span class="nt">-i</span> <span class="nb">rails</span>/main
<span class="go">
</span><span class="gp">&lt; Choose 'squash' for all of your commits except the first one. &gt;</span><span class="w">
</span><span class="gp">&lt; Edit the commit message to make sense, and describe all your changes. &gt;</span><span class="w">
</span><span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="nb">git </span>push fork my_new_branch <span class="nt">--force-with-lease</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="git fetch rails
git checkout my_new_branch
git rebase -i rails/main
git push fork my_new_branch --force-with-lease
">Copy</button>
</div>
<p>You should be able to refresh the pull request on GitHub and see that it has
been updated.</p>

<h5 id="updating-a-pull-request"><a class="anchorlink" href="#updating-a-pull-request">5.18.2 Updating a Pull Request</a></h5>

<p>Sometimes you will be asked to make some changes to the code you have
already committed. This can include amending existing commits. In this
case Git will not allow you to push the changes as the pushed branch
and local branch do not match. Instead of opening a new pull request,
you can force push to your branch on GitHub as described earlier in
squashing commits section:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">git </span>push fork my_new_branch <span class="nt">--force-with-lease</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="git push fork my_new_branch --force-with-lease
">Copy</button>
</div>
<p>This will update the branch and pull request on GitHub with your new code.
By force pushing with <code>--force-with-lease</code>, git will more safely update
the remote than with a typical <code>-f</code>, which can delete work from the remote
that you don't already have.</p>

<h4 id="older-versions-of-ruby-on-rails"><a class="anchorlink" href="#older-versions-of-ruby-on-rails">5.19 Older Versions of Ruby on Rails</a></h4>

<p>If you want to add a fix to older versions of Ruby on Rails, you'll need to set up and switch to your own local tracking branch. Here is an example to switch to the 4-0-stable branch:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">git </span>branch <span class="nt">--track</span> 4-0-stable <span class="nb">rails</span>/4-0-stable
<span class="gp">$</span><span class="w"> </span><span class="nb">git </span>checkout 4-0-stable
</code></pre>
<button class="clipboard-button" data-clipboard-text="git branch --track 4-0-stable rails/4-0-stable
git checkout 4-0-stable
">Copy</button>
</div>
<div class="info"><p>You may want to <a href="http://qugstart.com/blog/git-and-svn/add-colored-git-branch-name-to-your-shell-prompt/">put your Git branch name in your shell prompt</a> to make it easier to remember which version of the code you're working with.</p></div>

<div class="note"><p>Before working on older versions, please check the <a href="maintenance_policy.html">maintenance policy</a>.</p></div>

<h5 id="backporting"><a class="anchorlink" href="#backporting">5.19.1 Backporting</a></h5>

<p>Changes that are merged into main are intended for the next major release of Rails. Sometimes, it might be beneficial to propagate your changes back to older stable branches for inclusion in maintenance releases. Generally, security fixes and bug fixes are good candidates for a backport, while new features and patches that change expected behavior will not be accepted. When in doubt, it is best to consult a Rails team member before backporting your changes to avoid wasted effort.</p>

<p>For simple fixes, the easiest way to backport your changes is to <a href="https://www.devroom.io/2009/10/26/how-to-create-and-apply-a-patch-with-git/">extract a diff from your changes in main and apply them to the target branch</a>.</p>

<p>First, make sure your changes are the only difference between your current branch and main:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">git </span>log main..HEAD
</code></pre>
<button class="clipboard-button" data-clipboard-text="git log main..HEAD
">Copy</button>
</div>
<p>Then extract the diff:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">git </span>format-patch main <span class="nt">--stdout</span> <span class="o">&gt;</span> ~/my_changes.patch
</code></pre>
<button class="clipboard-button" data-clipboard-text="git format-patch main --stdout &gt; ~/my_changes.patch
">Copy</button>
</div>
<p>Switch over to the target branch and apply your changes:</p>

<div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">git </span>checkout <span class="nt">-b</span> my_backport_branch 4-2-stable
<span class="gp">$</span><span class="w"> </span><span class="nb">git </span>apply ~/my_changes.patch
</code></pre>
<button class="clipboard-button" data-clipboard-text="git checkout -b my_backport_branch 4-2-stable
git apply ~/my_changes.patch
">Copy</button>
</div>
<p>This works well for simple changes. However, if your changes are complicated or if the code in main has deviated significantly from your target branch, it might require more work on your part. The difficulty of a backport varies greatly from case to case, and sometimes it is simply not worth the effort.</p>

<p>Once you have resolved all conflicts and made sure all the tests are passing, push your changes and open a separate pull request for your backport. It is also worth noting that older branches might have a different set of build targets than main. When possible, it is best to first test your backport locally against the oldest Ruby version permitted by the target branch's <code>rails.gemspec</code> before submitting your pull request.</p>

<p>And then... think about your next contribution!</p>
</body>
</html>
