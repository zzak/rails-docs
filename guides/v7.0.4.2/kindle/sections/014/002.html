<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>3 Non-Resourceful Routes</title>
<link rel="stylesheet" type="text/css" href="/home/rails/v7.0.4.2/guides/output/kindle/stylesheets/kindle.css">
</head>
<body>
<h3 id="non-resourceful-routes"><a class="anchorlink" href="#non-resourceful-routes">3 Non-Resourceful Routes</a></h3>
<p>In addition to resource routing, Rails has powerful support for routing arbitrary URLs to actions. Here, you don't get groups of routes automatically generated by resourceful routing. Instead, you set up each route separately within your application.</p>

<p>While you should usually use resourceful routing, there are still many places where the simpler routing is more appropriate. There's no need to try to shoehorn every last piece of your application into a resourceful framework if that's not a good fit.</p>

<p>In particular, simple routing makes it very easy to map legacy URLs to new Rails actions.</p>

<h4 id="bound-parameters"><a class="anchorlink" href="#bound-parameters">3.1 Bound Parameters</a></h4>

<p>When you set up a regular route, you supply a series of symbols that Rails maps to parts of an incoming HTTP request. For example, consider this route:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'photos(/:id)'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'photos#display'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'photos(/:id)', to: 'photos#display'
">Copy</button>
</div>
<p>If an incoming request of <code>/photos/1</code> is processed by this route (because it hasn't matched any previous route in the file), then the result will be to invoke the <code>display</code> action of the <code>PhotosController</code>, and to make the final parameter <code>"1"</code> available as <code>params[:id]</code>. This route will also route the incoming request of <code>/photos</code> to <code>PhotosController#display</code>, since <code>:id</code> is an optional parameter, denoted by parentheses.</p>

<h4 id="dynamic-segments"><a class="anchorlink" href="#dynamic-segments">3.2 Dynamic Segments</a></h4>

<p>You can set up as many dynamic segments within a regular route as you like. Any segment will be available to the action as part of <code>params</code>. If you set up this route:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'photos/:id/:user_id'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'photos#show'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'photos/:id/:user_id', to: 'photos#show'
">Copy</button>
</div>
<p>An incoming path of <code>/photos/1/2</code> will be dispatched to the <code>show</code> action of the <code>PhotosController</code>. <code>params[:id]</code> will be <code>"1"</code>, and <code>params[:user_id]</code> will be <code>"2"</code>.</p>

<div class="info"><p>By default, dynamic segments don't accept dots - this is because the dot is used as a separator for formatted routes. If you need to use a dot within a dynamic segment, add a constraint that overrides this – for example, <code>id: /[^\/]+/</code> allows anything except a slash.</p></div>

<h4 id="static-segments"><a class="anchorlink" href="#static-segments">3.3 Static Segments</a></h4>

<p>You can specify static segments when creating a route by not prepending a colon to a segment:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'photos/:id/with_user/:user_id'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'photos#show'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'photos/:id/with_user/:user_id', to: 'photos#show'
">Copy</button>
</div>
<p>This route would respond to paths such as <code>/photos/1/with_user/2</code>. In this case, <code>params</code> would be <code>{ controller: 'photos', action: 'show', id: '1', user_id: '2' }</code>.</p>

<h4 id="the-query-string"><a class="anchorlink" href="#the-query-string">3.4 The Query String</a></h4>

<p>The <code>params</code> will also include any parameters from the query string. For example, with this route:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'photos/:id'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'photos#show'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'photos/:id', to: 'photos#show'
">Copy</button>
</div>
<p>An incoming path of <code>/photos/1?user_id=2</code> will be dispatched to the <code>show</code> action of the <code>Photos</code> controller. <code>params</code> will be <code>{ controller: 'photos', action: 'show', id: '1', user_id: '2' }</code>.</p>

<h4 id="defining-defaults"><a class="anchorlink" href="#defining-defaults">3.5 Defining Defaults</a></h4>

<p>You can define defaults in a route by supplying a hash for the <code>:defaults</code> option. This even applies to parameters that you do not specify as dynamic segments. For example:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'photos/:id'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'photos#show'</span><span class="p">,</span> <span class="ss">defaults: </span><span class="p">{</span> <span class="ss">format: </span><span class="s1">'jpg'</span> <span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'photos/:id', to: 'photos#show', defaults: { format: 'jpg' }
">Copy</button>
</div>
<p>Rails would match <code>photos/12</code> to the <code>show</code> action of <code>PhotosController</code>, and set <code>params[:format]</code> to <code>"jpg"</code>.</p>

<p>You can also use a <a href="https://api.rubyonrails.org/v7.0.4.2/classes/ActionDispatch/Routing/Mapper/Scoping.html#method-i-defaults"><code>defaults</code></a> block to define the defaults for multiple items:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">defaults</span> <span class="ss">format: :json</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:photos</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="defaults format: :json do
  resources :photos
end
">Copy</button>
</div>
<div class="note"><p>You cannot override defaults via query parameters - this is for security reasons. The only defaults that can be overridden are dynamic segments via substitution in the URL path.</p></div>

<h4 id="naming-routes"><a class="anchorlink" href="#naming-routes">3.6 Naming Routes</a></h4>

<p>You can specify a name for any route using the <code>:as</code> option:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'exit'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'sessions#destroy'</span><span class="p">,</span> <span class="ss">as: :logout</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'exit', to: 'sessions#destroy', as: :logout
">Copy</button>
</div>
<p>This will create <code>logout_path</code> and <code>logout_url</code> as named route helpers in your application. Calling <code>logout_path</code> will return <code>/exit</code></p>

<p>You can also use this to override routing methods defined by resources by placing custom routes before the resource is defined, like this:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">':username'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'users#show'</span><span class="p">,</span> <span class="ss">as: :user</span>
<span class="n">resources</span> <span class="ss">:users</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get ':username', to: 'users#show', as: :user
resources :users
">Copy</button>
</div>
<p>This will define a <code>user_path</code> method that will be available in controllers, helpers, and views that will go to a route such as <code>/bob</code>. Inside the <code>show</code> action of <code>UsersController</code>, <code>params[:username]</code> will contain the username for the user. Change <code>:username</code> in the route definition if you do not want your parameter name to be <code>:username</code>.</p>

<h4 id="http-verb-constraints"><a class="anchorlink" href="#http-verb-constraints">3.7 HTTP Verb Constraints</a></h4>

<p>In general, you should use the <a href="https://api.rubyonrails.org/v7.0.4.2/classes/ActionDispatch/Routing/Mapper/HttpHelpers.html#method-i-get"><code>get</code></a>, <a href="https://api.rubyonrails.org/v7.0.4.2/classes/ActionDispatch/Routing/Mapper/HttpHelpers.html#method-i-post"><code>post</code></a>, <a href="https://api.rubyonrails.org/v7.0.4.2/classes/ActionDispatch/Routing/Mapper/HttpHelpers.html#method-i-put"><code>put</code></a>, <a href="https://api.rubyonrails.org/v7.0.4.2/classes/ActionDispatch/Routing/Mapper/HttpHelpers.html#method-i-patch"><code>patch</code></a>, and <a href="https://api.rubyonrails.org/v7.0.4.2/classes/ActionDispatch/Routing/Mapper/HttpHelpers.html#method-i-delete"><code>delete</code></a> methods to constrain a route to a particular verb. You can use the <a href="https://api.rubyonrails.org/v7.0.4.2/classes/ActionDispatch/Routing/Mapper/Base.html#method-i-match"><code>match</code></a> method with the <code>:via</code> option to match multiple verbs at once:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">match</span> <span class="s1">'photos'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'photos#show'</span><span class="p">,</span> <span class="ss">via: </span><span class="p">[</span><span class="ss">:get</span><span class="p">,</span> <span class="ss">:post</span><span class="p">]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="match 'photos', to: 'photos#show', via: [:get, :post]
">Copy</button>
</div>
<p>You can match all verbs to a particular route using <code>via: :all</code>:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">match</span> <span class="s1">'photos'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'photos#show'</span><span class="p">,</span> <span class="ss">via: :all</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="match 'photos', to: 'photos#show', via: :all
">Copy</button>
</div>
<div class="note"><p>Routing both <code>GET</code> and <code>POST</code> requests to a single action has security implications. In general, you should avoid routing all verbs to an action unless you have a good reason to.</p></div>

<div class="note"><p><code>GET</code> in Rails won't check for CSRF token. You should never write to the database from <code>GET</code> requests, for more information see the <a href="security.html#csrf-countermeasures">security guide</a> on CSRF countermeasures.</p></div>

<h4 id="segment-constraints"><a class="anchorlink" href="#segment-constraints">3.8 Segment Constraints</a></h4>

<p>You can use the <code>:constraints</code> option to enforce a format for a dynamic segment:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'photos/:id'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'photos#show'</span><span class="p">,</span> <span class="ss">constraints: </span><span class="p">{</span> <span class="ss">id: </span><span class="sr">/[A-Z]\d{5}/</span> <span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'photos/:id', to: 'photos#show', constraints: { id: /[A-Z]\d{5}/ }
">Copy</button>
</div>
<p>This route would match paths such as <code>/photos/A12345</code>, but not <code>/photos/893</code>. You can more succinctly express the same route this way:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'photos/:id'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'photos#show'</span><span class="p">,</span> <span class="ss">id: </span><span class="sr">/[A-Z]\d{5}/</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'photos/:id', to: 'photos#show', id: /[A-Z]\d{5}/
">Copy</button>
</div>
<p><code>:constraints</code> takes regular expressions with the restriction that regexp anchors can't be used. For example, the following route will not work:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'/:id'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'articles#show'</span><span class="p">,</span> <span class="ss">constraints: </span><span class="p">{</span> <span class="ss">id: </span><span class="sr">/^\d/</span> <span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get '/:id', to: 'articles#show', constraints: { id: /^\d/ }
">Copy</button>
</div>
<p>However, note that you don't need to use anchors because all routes are anchored at the start and the end.</p>

<p>For example, the following routes would allow for <code>articles</code> with <code>to_param</code> values like <code>1-hello-world</code> that always begin with a number and <code>users</code> with <code>to_param</code> values like <code>david</code> that never begin with a number to share the root namespace:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'/:id'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'articles#show'</span><span class="p">,</span> <span class="ss">constraints: </span><span class="p">{</span> <span class="ss">id: </span><span class="sr">/\d.+/</span> <span class="p">}</span>
<span class="n">get</span> <span class="s1">'/:username'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'users#show'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get '/:id', to: 'articles#show', constraints: { id: /\d.+/ }
get '/:username', to: 'users#show'
">Copy</button>
</div>
<h4 id="request-based-constraints"><a class="anchorlink" href="#request-based-constraints">3.9 Request-Based Constraints</a></h4>

<p>You can also constrain a route based on any method on the <a href="action_controller_overview.html#the-request-object">Request object</a> that returns a <code>String</code>.</p>

<p>You specify a request-based constraint the same way that you specify a segment constraint:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'photos'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'photos#index'</span><span class="p">,</span> <span class="ss">constraints: </span><span class="p">{</span> <span class="ss">subdomain: </span><span class="s1">'admin'</span> <span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'photos', to: 'photos#index', constraints: { subdomain: 'admin' }
">Copy</button>
</div>
<p>You can also specify constraints by using a <a href="https://api.rubyonrails.org/v7.0.4.2/classes/ActionDispatch/Routing/Mapper/Scoping.html#method-i-constraints"><code>constraints</code></a> block:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">namespace</span> <span class="ss">:admin</span> <span class="k">do</span>
  <span class="n">constraints</span> <span class="ss">subdomain: </span><span class="s1">'admin'</span> <span class="k">do</span>
    <span class="n">resources</span> <span class="ss">:photos</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="namespace :admin do
  constraints subdomain: 'admin' do
    resources :photos
  end
end
">Copy</button>
</div>
<div class="note"><p>Request constraints work by calling a method on the <a href="action_controller_overview.html#the-request-object">Request object</a> with the same name as the hash key and then comparing the return value with the hash value. Therefore, constraint values should match the corresponding Request object method return type. For example: <code>constraints: { subdomain: 'api' }</code> will match an <code>api</code> subdomain as expected. However, using a symbol <code>constraints: { subdomain: :api }</code> will not, because <code>request.subdomain</code> returns <code>'api'</code> as a String.</p></div>

<div class="note"><p>There is an exception for the <code>format</code> constraint: while it's a method on the Request object, it's also an implicit optional parameter on every path. Segment constraints take precedence and the <code>format</code> constraint is only applied as such when enforced through a hash. For example, <code>get 'foo', constraints: { format: 'json' }</code> will match <code>GET  /foo</code> because the format is optional by default. However, you can <a href="#advanced-constraints">use a lambda</a> like in <code>get 'foo', constraints: lambda { |req| req.format == :json }</code> and the route will only match explicit JSON requests.</p></div>

<h4 id="advanced-constraints"><a class="anchorlink" href="#advanced-constraints">3.10 Advanced Constraints</a></h4>

<p>If you have a more advanced constraint, you can provide an object that responds to <code>matches?</code> that Rails should use. Let's say you wanted to route all users on a restricted list to the <code>RestrictedListController</code>. You could do:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">RestrictedListConstraint</span>
  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@ips</span> <span class="o">=</span> <span class="no">RestrictedList</span><span class="p">.</span><span class="nf">retrieve_ips</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">matches?</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="vi">@ips</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="nf">remote_ip</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s1">'*path'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'restricted_list#index'</span><span class="p">,</span>
    <span class="ss">constraints: </span><span class="no">RestrictedListConstraint</span><span class="p">.</span><span class="nf">new</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class RestrictedListConstraint
  def initialize
    @ips = RestrictedList.retrieve_ips
  end

  def matches?(request)
    @ips.include?(request.remote_ip)
  end
end

Rails.application.routes.draw do
  get '*path', to: 'restricted_list#index',
    constraints: RestrictedListConstraint.new
end
">Copy</button>
</div>
<p>You can also specify constraints as a lambda:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s1">'*path'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'restricted_list#index'</span><span class="p">,</span>
    <span class="ss">constraints: </span><span class="nb">lambda</span> <span class="p">{</span> <span class="o">|</span><span class="n">request</span><span class="o">|</span> <span class="no">RestrictedList</span><span class="p">.</span><span class="nf">retrieve_ips</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="nf">remote_ip</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Rails.application.routes.draw do
  get '*path', to: 'restricted_list#index',
    constraints: lambda { |request| RestrictedList.retrieve_ips.include?(request.remote_ip) }
end
">Copy</button>
</div>
<p>Both the <code>matches?</code> method and the lambda gets the <code>request</code> object as an argument.</p>

<h5 id="constraints-in-a-block-form"><a class="anchorlink" href="#constraints-in-a-block-form">3.10.1 Constraints in a block form</a></h5>

<p>You can specify constraints in a block form. This is useful for when you need to apply the same rule to several routes. For example:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">RestrictedListConstraint</span>
  <span class="c1"># ...Same as the example above</span>
<span class="k">end</span>

<span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">constraints</span><span class="p">(</span><span class="no">RestrictedListConstraint</span><span class="p">.</span><span class="nf">new</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">get</span> <span class="s1">'*path'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'restricted_list#index'</span>
    <span class="n">get</span> <span class="s1">'*other-path'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'other_restricted_list#index'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class RestrictedListConstraint
  # ...Same as the example above
end

Rails.application.routes.draw do
  constraints(RestrictedListConstraint.new) do
    get '*path', to: 'restricted_list#index'
    get '*other-path', to: 'other_restricted_list#index'
  end
end
">Copy</button>
</div>
<p>You can also use a <code>lambda</code>:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">constraints</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">{</span> <span class="o">|</span><span class="n">request</span><span class="o">|</span> <span class="no">RestrictedList</span><span class="p">.</span><span class="nf">retrieve_ips</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="nf">remote_ip</span><span class="p">)</span> <span class="p">})</span> <span class="k">do</span>
    <span class="n">get</span> <span class="s1">'*path'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'restricted_list#index'</span>
    <span class="n">get</span> <span class="s1">'*other-path'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'other_restricted_list#index'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Rails.application.routes.draw do
  constraints(lambda { |request| RestrictedList.retrieve_ips.include?(request.remote_ip) }) do
    get '*path', to: 'restricted_list#index'
    get '*other-path', to: 'other_restricted_list#index'
  end
end
">Copy</button>
</div>
<h4 id="route-globbing-and-wildcard-segments"><a class="anchorlink" href="#route-globbing-and-wildcard-segments">3.11 Route Globbing and Wildcard Segments</a></h4>

<p>Route globbing is a way to specify that a particular parameter should be matched to all the remaining parts of a route. For example:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'photos/*other'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'photos#unknown'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'photos/*other', to: 'photos#unknown'
">Copy</button>
</div>
<p>This route would match <code>photos/12</code> or <code>/photos/long/path/to/12</code>, setting <code>params[:other]</code> to <code>"12"</code> or <code>"long/path/to/12"</code>. The segments prefixed with a star are called "wildcard segments".</p>

<p>Wildcard segments can occur anywhere in a route. For example:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'books/*section/:title'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'books#show'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'books/*section/:title', to: 'books#show'
">Copy</button>
</div>
<p>would match <code>books/some/section/last-words-a-memoir</code> with <code>params[:section]</code> equals <code>'some/section'</code>, and <code>params[:title]</code> equals <code>'last-words-a-memoir'</code>.</p>

<p>Technically, a route can have even more than one wildcard segment. The matcher assigns segments to parameters in an intuitive way. For example:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'*a/foo/*b'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'test#index'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get '*a/foo/*b', to: 'test#index'
">Copy</button>
</div>
<p>would match <code>zoo/woo/foo/bar/baz</code> with <code>params[:a]</code> equals <code>'zoo/woo'</code>, and <code>params[:b]</code> equals <code>'bar/baz'</code>.</p>

<div class="note"><p>By requesting <code>'/foo/bar.json'</code>, your <code>params[:pages]</code> will be equal to <code>'foo/bar'</code> with the request format of JSON. If you want the old 3.0.x behavior back, you could supply <code>format: false</code> like this:</p></div>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'*pages'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'pages#show'</span><span class="p">,</span> <span class="ss">format: </span><span class="kp">false</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get '*pages', to: 'pages#show', format: false
">Copy</button>
</div>
<div class="note"><p>If you want to make the format segment mandatory, so it cannot be omitted, you can supply <code>format: true</code> like this:</p></div>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'*pages'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'pages#show'</span><span class="p">,</span> <span class="ss">format: </span><span class="kp">true</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get '*pages', to: 'pages#show', format: true
">Copy</button>
</div>
<h4 id="redirection"><a class="anchorlink" href="#redirection">3.12 Redirection</a></h4>

<p>You can redirect any path to another path by using the <a href="https://api.rubyonrails.org/v7.0.4.2/classes/ActionDispatch/Routing/Redirection.html#method-i-redirect"><code>redirect</code></a> helper in your router:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'/stories'</span><span class="p">,</span> <span class="ss">to: </span><span class="n">redirect</span><span class="p">(</span><span class="s1">'/articles'</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get '/stories', to: redirect('/articles')
">Copy</button>
</div>
<p>You can also reuse dynamic segments from the match in the path to redirect to:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'/stories/:name'</span><span class="p">,</span> <span class="ss">to: </span><span class="n">redirect</span><span class="p">(</span><span class="s1">'/articles/%{name}'</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get '/stories/:name', to: redirect('/articles/%{name}')
">Copy</button>
</div>
<p>You can also provide a block to <code>redirect</code>, which receives the symbolized path parameters and the request object:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'/stories/:name'</span><span class="p">,</span> <span class="ss">to: </span><span class="n">redirect</span> <span class="p">{</span> <span class="o">|</span><span class="n">path_params</span><span class="p">,</span> <span class="n">req</span><span class="o">|</span> <span class="s2">"/articles/</span><span class="si">#{</span><span class="n">path_params</span><span class="p">[</span><span class="ss">:name</span><span class="p">].</span><span class="nf">pluralize</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
<span class="n">get</span> <span class="s1">'/stories'</span><span class="p">,</span> <span class="ss">to: </span><span class="n">redirect</span> <span class="p">{</span> <span class="o">|</span><span class="n">path_params</span><span class="p">,</span> <span class="n">req</span><span class="o">|</span> <span class="s2">"/articles/</span><span class="si">#{</span><span class="n">req</span><span class="p">.</span><span class="nf">subdomain</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get '/stories/:name', to: redirect { |path_params, req| &quot;/articles/#{path_params[:name].pluralize}&quot; }
get '/stories', to: redirect { |path_params, req| &quot;/articles/#{req.subdomain}&quot; }
">Copy</button>
</div>
<p>Please note that default redirection is a 301 "Moved Permanently" redirect. Keep in mind that some web browsers or proxy servers will cache this type of redirect, making the old page inaccessible. You can use the <code>:status</code> option to change the response status:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'/stories/:name'</span><span class="p">,</span> <span class="ss">to: </span><span class="n">redirect</span><span class="p">(</span><span class="s1">'/articles/%{name}'</span><span class="p">,</span> <span class="ss">status: </span><span class="mi">302</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get '/stories/:name', to: redirect('/articles/%{name}', status: 302)
">Copy</button>
</div>
<p>In all of these cases, if you don't provide the leading host (<code>http://www.example.com</code>), Rails will take those details from the current request.</p>

<h4 id="routing-to-rack-applications"><a class="anchorlink" href="#routing-to-rack-applications">3.13 Routing to Rack Applications</a></h4>

<p>Instead of a String like <code>'articles#index'</code>, which corresponds to the <code>index</code> action in the <code>ArticlesController</code>, you can specify any <a href="rails_on_rack.html">Rack application</a> as the endpoint for a matcher:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">match</span> <span class="s1">'/application.js'</span><span class="p">,</span> <span class="ss">to: </span><span class="no">MyRackApp</span><span class="p">,</span> <span class="ss">via: :all</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="match '/application.js', to: MyRackApp, via: :all
">Copy</button>
</div>
<p>As long as <code>MyRackApp</code> responds to <code>call</code> and returns a <code>[status, headers, body]</code>, the router won't know the difference between the Rack application and an action. This is an appropriate use of <code>via: :all</code>, as you will want to allow your Rack application to handle all verbs as it considers appropriate.</p>

<div class="note"><p>For the curious, <code>'articles#index'</code> actually expands out to <code>ArticlesController.action(:index)</code>, which returns a valid Rack application.</p></div>

<div class="note"><p>Since procs/lambdas are objects that respond to <code>call</code>, you can implement very simple routes (e.g. for health checks) inline:<br><code>get '/health', to: -&gt;(env) { [204, {}, ['']] }</code></p></div>

<p>If you specify a Rack application as the endpoint for a matcher, remember that
the route will be unchanged in the receiving application. With the following
route your Rack application should expect the route to be <code>/admin</code>:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">match</span> <span class="s1">'/admin'</span><span class="p">,</span> <span class="ss">to: </span><span class="no">AdminApp</span><span class="p">,</span> <span class="ss">via: :all</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="match '/admin', to: AdminApp, via: :all
">Copy</button>
</div>
<p>If you would prefer to have your Rack application receive requests at the root
path instead, use <a href="https://api.rubyonrails.org/v7.0.4.2/classes/ActionDispatch/Routing/Mapper/Base.html#method-i-mount"><code>mount</code></a>:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">mount</span> <span class="no">AdminApp</span><span class="p">,</span> <span class="ss">at: </span><span class="s1">'/admin'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="mount AdminApp, at: '/admin'
">Copy</button>
</div>
<h4 id="using-root"><a class="anchorlink" href="#using-root">3.14 Using <code>root</code></a></h4>

<p>You can specify what Rails should route <code>'/'</code> to with the <a href="https://api.rubyonrails.org/v7.0.4.2/classes/ActionDispatch/Routing/Mapper/Resources.html#method-i-root"><code>root</code></a> method:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">root</span> <span class="ss">to: </span><span class="s1">'pages#main'</span>
<span class="n">root</span> <span class="s1">'pages#main'</span> <span class="c1"># shortcut for the above</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="root to: 'pages#main'
root 'pages#main' # shortcut for the above
">Copy</button>
</div>
<p>You should put the <code>root</code> route at the top of the file, because it is the most popular route and should be matched first.</p>

<div class="note"><p>The <code>root</code> route only routes <code>GET</code> requests to the action.</p></div>

<p>You can also use root inside namespaces and scopes as well. For example:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">namespace</span> <span class="ss">:admin</span> <span class="k">do</span>
  <span class="n">root</span> <span class="ss">to: </span><span class="s2">"admin#index"</span>
<span class="k">end</span>

<span class="n">root</span> <span class="ss">to: </span><span class="s2">"home#index"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='namespace :admin do
  root to: "admin#index"
end

root to: "home#index"
'>Copy</button>
</div>
<h4 id="unicode-character-routes"><a class="anchorlink" href="#unicode-character-routes">3.15 Unicode Character Routes</a></h4>

<p>You can specify unicode character routes directly. For example:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'こんにちは'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'welcome#index'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'こんにちは', to: 'welcome#index'
">Copy</button>
</div>
<h4 id="direct-routes"><a class="anchorlink" href="#direct-routes">3.16 Direct Routes</a></h4>

<p>You can create custom URL helpers directly by calling <a href="https://api.rubyonrails.org/v7.0.4.2/classes/ActionDispatch/Routing/Mapper/CustomUrls.html#method-i-direct"><code>direct</code></a>. For example:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">direct</span> <span class="ss">:homepage</span> <span class="k">do</span>
  <span class="s2">"https://rubyonrails.org"</span>
<span class="k">end</span>

<span class="c1"># &gt;&gt; homepage_url</span>
<span class="c1"># =&gt; "https://rubyonrails.org"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='direct :homepage do
  "https://rubyonrails.org"
end

# &gt;&gt; homepage_url
# =&gt; "https://rubyonrails.org"
'>Copy</button>
</div>
<p>The return value of the block must be a valid argument for the <code>url_for</code> method. So, you can pass a valid string URL, Hash, Array, an Active Model instance, or an Active Model class.</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">direct</span> <span class="ss">:commentable</span> <span class="k">do</span> <span class="o">|</span><span class="n">model</span><span class="o">|</span>
  <span class="p">[</span> <span class="n">model</span><span class="p">,</span> <span class="ss">anchor: </span><span class="n">model</span><span class="p">.</span><span class="nf">dom_id</span> <span class="p">]</span>
<span class="k">end</span>

<span class="n">direct</span> <span class="ss">:main</span> <span class="k">do</span>
  <span class="p">{</span> <span class="ss">controller: </span><span class="s1">'pages'</span><span class="p">,</span> <span class="ss">action: </span><span class="s1">'index'</span><span class="p">,</span> <span class="ss">subdomain: </span><span class="s1">'www'</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="direct :commentable do |model|
  [ model, anchor: model.dom_id ]
end

direct :main do
  { controller: 'pages', action: 'index', subdomain: 'www' }
end
">Copy</button>
</div>
<h4 id="using-resolve"><a class="anchorlink" href="#using-resolve">3.17 Using <code>resolve</code></a></h4>

<p>The <a href="https://api.rubyonrails.org/v7.0.4.2/classes/ActionDispatch/Routing/Mapper/CustomUrls.html#method-i-resolve"><code>resolve</code></a> method allows customizing polymorphic mapping of models. For example:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="n">resource</span> <span class="ss">:basket</span>

<span class="n">resolve</span><span class="p">(</span><span class="s2">"Basket"</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="ss">:basket</span><span class="p">]</span> <span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='resource :basket

resolve("Basket") { [:basket] }
'>Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@basket</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="c">&lt;!-- basket form --&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: @basket do |form| %&gt;
  &lt;!-- basket form --&gt;
&lt;% end %&gt;
">Copy</button>
</div>
<p>This will generate the singular URL <code>/basket</code> instead of the usual <code>/baskets/:id</code>.</p>
</body>
</html>
