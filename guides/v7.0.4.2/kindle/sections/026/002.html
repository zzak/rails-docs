<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>3 Debugging with the debug gem</title>
<link rel="stylesheet" type="text/css" href="/home/rails/v7.0.4.2/guides/output/kindle/stylesheets/kindle.css">
</head>
<body>
<h3 id="debugging-with-the-debug-gem"><a class="anchorlink" href="#debugging-with-the-debug-gem">3 Debugging with the <code>debug</code> gem</a></h3>
<p>When your code is behaving in unexpected ways, you can try printing to logs or
the console to diagnose the problem. Unfortunately, there are times when this
sort of error tracking is not effective in finding the root cause of a problem.
When you actually need to journey into your running source code, the debugger
is your best companion.</p>

<p>The debugger can also help you if you want to learn about the Rails source code
but don't know where to start. Just debug any request to your application and
use this guide to learn how to move from the code you have written into the
underlying Rails code.</p>

<p>Rails 7 includes the <code>debug</code> gem in the <code>Gemfile</code> of new applications generated
by CRuby. By default, it is ready in the <code>development</code> and <code>test</code> environments.
Please check its <a href="https://github.com/ruby/debug">documentation</a> for usage.</p>

<h4 id="entering-a-debugging-session"><a class="anchorlink" href="#entering-a-debugging-session">3.1 Entering a Debugging Session</a></h4>

<p>By default, a debugging session will start after the <code>debug</code> library is required, which happens when your app boots. But don't worry, the session won't interfere your program.</p>

<p>To enter the debugging session, you can use <code>binding.break</code> and its aliases: <code>binding.b</code> and <code>debugger</code>. The following examples will use <code>debugger</code>:</p>

<div class="code_container">
<pre><code class="highlight rb"><span class="k">class</span> <span class="nc">PostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">before_action</span> <span class="ss">:set_post</span><span class="p">,</span> <span class="ss">only: </span><span class="sx">%i[ show edit update destroy ]</span>

  <span class="c1"># GET /posts or /posts.json</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@posts</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">all</span>
    <span class="n">debugger</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class PostsController &lt; ApplicationController
  before_action :set_post, only: %i[ show edit update destroy ]

  # GET /posts or /posts.json
  def index
    @posts = Post.all
    debugger
  end
  # ...
end
">Copy</button>
</div>
<p>Once your app evaluates the debugging statement, it'll enter the debugging session:</p>

<div class="code_container">
<pre><code class="highlight rb"><span class="no">Processing</span> <span class="n">by</span> <span class="no">PostsController</span><span class="c1">#index as HTML</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="k">in</span> <span class="o">~</span><span class="sr">/projects/</span><span class="n">rails</span><span class="o">-</span><span class="n">guide</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">posts_controller</span><span class="p">.</span><span class="nf">rb</span>
     <span class="mi">2</span><span class="o">|</span>   <span class="n">before_action</span> <span class="ss">:set_post</span><span class="p">,</span> <span class="ss">only: </span><span class="sx">%i[ show edit update destroy ]</span>
     <span class="mi">3</span><span class="o">|</span>
     <span class="mi">4</span><span class="o">|</span>   <span class="c1"># GET /posts or /posts.json</span>
     <span class="mi">5</span><span class="o">|</span>   <span class="k">def</span> <span class="nf">index</span>
     <span class="mi">6</span><span class="o">|</span>     <span class="vi">@posts</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">all</span>
<span class="o">=&gt;</span>   <span class="mi">7</span><span class="o">|</span>     <span class="n">debugger</span>
     <span class="mi">8</span><span class="o">|</span>   <span class="k">end</span>
     <span class="mi">9</span><span class="o">|</span>
    <span class="mi">10</span><span class="o">|</span>   <span class="c1"># GET /posts/1 or /posts/1.json</span>
    <span class="mi">11</span><span class="o">|</span>   <span class="k">def</span> <span class="nf">show</span>
<span class="o">=&gt;</span><span class="c1">#0    PostsController#index at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:7</span>
  <span class="c1">#1    ActionController::BasicImplicitRender#send_action(method="index", args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6</span>
  <span class="c1"># and 72 frames (use `bt' command for all frames)</span>
<span class="p">(</span><span class="n">rdbg</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Processing by PostsController#index as HTML
[2, 11] in ~/projects/rails-guide-example/app/controllers/posts_controller.rb
     2|   before_action :set_post, only: %i[ show edit update destroy ]
     3|
     4|   # GET /posts or /posts.json
     5|   def index
     6|     @posts = Post.all
=&gt;   7|     debugger
     8|   end
     9|
    10|   # GET /posts/1 or /posts/1.json
    11|   def show
=&gt;#0    PostsController#index at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:7
  #1    ActionController::BasicImplicitRender#send_action(method=&quot;index&quot;, args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6
  # and 72 frames (use `bt' command for all frames)
(rdbg)
">Copy</button>
</div>
<p>You can exit the debugging session at any time and continue your application execution with the <code>continue</code> (or <code>c</code>) command.  Or, to exit both the debugging session and your application, use the <code>quit</code> (or <code>q</code>) command.</p>

<h4 id="the-context"><a class="anchorlink" href="#the-context">3.2 The Context</a></h4>

<p>After entering the debugging session, you can type in Ruby code as you're in a Rails console or IRB.</p>

<div class="code_container">
<pre><code class="highlight rb"><span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="vi">@posts</span>    <span class="c1"># ruby</span>
<span class="p">[]</span>
<span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="nb">self</span>
<span class="c1">#&lt;PostsController:0x0000000000aeb0&gt;</span>
<span class="p">(</span><span class="n">rdbg</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="(rdbg) @posts    # ruby
[]
(rdbg) self
#&lt;PostsController:0x0000000000aeb0&gt;
(rdbg)
">Copy</button>
</div>
<p>You can also use <code>p</code> or <code>pp</code> command to evaluate Ruby expressions (e.g. when a variable name conflicts with a debugger command).</p>

<div class="code_container">
<pre><code class="highlight rb"><span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="nb">p</span> <span class="n">headers</span>    <span class="c1"># command</span>
<span class="o">=&gt;</span> <span class="p">{</span><span class="s2">"X-Frame-Options"</span><span class="o">=&gt;</span><span class="s2">"SAMEORIGIN"</span><span class="p">,</span> <span class="s2">"X-XSS-Protection"</span><span class="o">=&gt;</span><span class="s2">"1; mode=block"</span><span class="p">,</span> <span class="s2">"X-Content-Type-Options"</span><span class="o">=&gt;</span><span class="s2">"nosniff"</span><span class="p">,</span> <span class="s2">"X-Download-Options"</span><span class="o">=&gt;</span><span class="s2">"noopen"</span><span class="p">,</span> <span class="s2">"X-Permitted-Cross-Domain-Policies"</span><span class="o">=&gt;</span><span class="s2">"none"</span><span class="p">,</span> <span class="s2">"Referrer-Policy"</span><span class="o">=&gt;</span><span class="s2">"strict-origin-when-cross-origin"</span><span class="p">}</span>
<span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="n">pp</span> <span class="n">headers</span>    <span class="c1"># command</span>
<span class="p">{</span><span class="s2">"X-Frame-Options"</span><span class="o">=&gt;</span><span class="s2">"SAMEORIGIN"</span><span class="p">,</span>
 <span class="s2">"X-XSS-Protection"</span><span class="o">=&gt;</span><span class="s2">"1; mode=block"</span><span class="p">,</span>
 <span class="s2">"X-Content-Type-Options"</span><span class="o">=&gt;</span><span class="s2">"nosniff"</span><span class="p">,</span>
 <span class="s2">"X-Download-Options"</span><span class="o">=&gt;</span><span class="s2">"noopen"</span><span class="p">,</span>
 <span class="s2">"X-Permitted-Cross-Domain-Policies"</span><span class="o">=&gt;</span><span class="s2">"none"</span><span class="p">,</span>
 <span class="s2">"Referrer-Policy"</span><span class="o">=&gt;</span><span class="s2">"strict-origin-when-cross-origin"</span><span class="p">}</span>
<span class="p">(</span><span class="n">rdbg</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='(rdbg) p headers    # command
=&gt; {"X-Frame-Options"=&gt;"SAMEORIGIN", "X-XSS-Protection"=&gt;"1; mode=block", "X-Content-Type-Options"=&gt;"nosniff", "X-Download-Options"=&gt;"noopen", "X-Permitted-Cross-Domain-Policies"=&gt;"none", "Referrer-Policy"=&gt;"strict-origin-when-cross-origin"}
(rdbg) pp headers    # command
{"X-Frame-Options"=&gt;"SAMEORIGIN",
 "X-XSS-Protection"=&gt;"1; mode=block",
 "X-Content-Type-Options"=&gt;"nosniff",
 "X-Download-Options"=&gt;"noopen",
 "X-Permitted-Cross-Domain-Policies"=&gt;"none",
 "Referrer-Policy"=&gt;"strict-origin-when-cross-origin"}
(rdbg)
'>Copy</button>
</div>
<p>Besides direct evaluation, debugger also helps you collect rich amount of information through different commands. Just to name a few here:</p>
<ul>
<li>
<code>info</code> (or <code>i</code>) - Information about current frame.</li>
<li>
<code>backtrace</code> (or <code>bt</code>) - Backtrace (with additional information).</li>
<li>
<code>outline</code> (or <code>o</code>, <code>ls</code>) - Available methods, constants, local variables, and instance variables in the current scope.</li>
</ul>
<h5 id="the-info-command"><a class="anchorlink" href="#the-info-command">3.2.1 The info command</a></h5>

<p>It'll give you an overview of the values of local and instance variables that are visible from the current frame.</p>

<div class="code_container">
<pre><code class="highlight rb"><span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="n">info</span>    <span class="c1"># command</span>
<span class="o">%</span><span class="nb">self</span> <span class="o">=</span> <span class="c1">#&lt;PostsController:0x0000000000af78&gt;</span>
<span class="vi">@_action_has_layout</span> <span class="o">=</span> <span class="kp">true</span>
<span class="vi">@_action_name</span> <span class="o">=</span> <span class="s2">"index"</span>
<span class="vi">@_config</span> <span class="o">=</span> <span class="p">{}</span>
<span class="vi">@_lookup_context</span> <span class="o">=</span> <span class="c1">#&lt;ActionView::LookupContext:0x00007fd91a037e38 @details_key=nil, @digest_cache=...</span>
<span class="vi">@_request</span> <span class="o">=</span> <span class="c1">#&lt;ActionDispatch::Request GET "http://localhost:3000/posts" for 127.0.0.1&gt;</span>
<span class="vi">@_response</span> <span class="o">=</span> <span class="c1">#&lt;ActionDispatch::Response:0x00007fd91a03ea08 @mon_data=#&lt;Monitor:0x00007fd91a03e8c8&gt;...</span>
<span class="vi">@_response_body</span> <span class="o">=</span> <span class="kp">nil</span>
<span class="vi">@_routes</span> <span class="o">=</span> <span class="kp">nil</span>
<span class="vi">@marked_for_same_origin_verification</span> <span class="o">=</span> <span class="kp">true</span>
<span class="vi">@posts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="vi">@rendered_format</span> <span class="o">=</span> <span class="kp">nil</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='(rdbg) info    # command
%self = #&lt;PostsController:0x0000000000af78&gt;
@_action_has_layout = true
@_action_name = "index"
@_config = {}
@_lookup_context = #&lt;ActionView::LookupContext:0x00007fd91a037e38 @details_key=nil, @digest_cache=...
@_request = #&lt;ActionDispatch::Request GET "http://localhost:3000/posts" for 127.0.0.1&gt;
@_response = #&lt;ActionDispatch::Response:0x00007fd91a03ea08 @mon_data=#&lt;Monitor:0x00007fd91a03e8c8&gt;...
@_response_body = nil
@_routes = nil
@marked_for_same_origin_verification = true
@posts = []
@rendered_format = nil
'>Copy</button>
</div>
<h5 id="the-backtrace-command"><a class="anchorlink" href="#the-backtrace-command">3.2.2 The backtrace command</a></h5>

<p>When used without any options, it lists all the frames on the stack:</p>

<div class="code_container">
<pre><code class="highlight rb"><span class="o">=&gt;</span><span class="c1">#0    PostsController#index at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:7</span>
  <span class="c1">#1    ActionController::BasicImplicitRender#send_action(method="index", args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6</span>
  <span class="c1">#2    AbstractController::Base#process_action(method_name="index", args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/abstract_controller/base.rb:214</span>
  <span class="c1">#3    ActionController::Rendering#process_action(#arg_rest=nil) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/rendering.rb:53</span>
  <span class="c1">#4    block in process_action at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/abstract_controller/callbacks.rb:221</span>
  <span class="c1">#5    block in run_callbacks at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activesupport-7.0.0.alpha2/lib/active_support/callbacks.rb:118</span>
  <span class="c1">#6    ActionText::Rendering::ClassMethods#with_renderer(renderer=#&lt;PostsController:0x0000000000af78&gt;) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actiontext-7.0.0.alpha2/lib/action_text/rendering.rb:20</span>
  <span class="c1">#7    block {|controller=#&lt;PostsController:0x0000000000af78&gt;, action=#&lt;Proc:0x00007fd91985f1c0 /Users/st0012/...|} in &lt;class:Engine&gt; (4 levels) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actiontext-7.0.0.alpha2/lib/action_text/engine.rb:69</span>
  <span class="c1">#8    [C] BasicObject#instance_exec at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activesupport-7.0.0.alpha2/lib/active_support/callbacks.rb:127</span>
  <span class="o">.....</span> <span class="n">and</span> <span class="n">more</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='=&gt;#0    PostsController#index at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:7
  #1    ActionController::BasicImplicitRender#send_action(method="index", args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6
  #2    AbstractController::Base#process_action(method_name="index", args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/abstract_controller/base.rb:214
  #3    ActionController::Rendering#process_action(#arg_rest=nil) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/rendering.rb:53
  #4    block in process_action at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/abstract_controller/callbacks.rb:221
  #5    block in run_callbacks at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activesupport-7.0.0.alpha2/lib/active_support/callbacks.rb:118
  #6    ActionText::Rendering::ClassMethods#with_renderer(renderer=#&lt;PostsController:0x0000000000af78&gt;) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actiontext-7.0.0.alpha2/lib/action_text/rendering.rb:20
  #7    block {|controller=#&lt;PostsController:0x0000000000af78&gt;, action=#&lt;Proc:0x00007fd91985f1c0 /Users/st0012/...|} in &lt;class:Engine&gt; (4 levels) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actiontext-7.0.0.alpha2/lib/action_text/engine.rb:69
  #8    [C] BasicObject#instance_exec at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activesupport-7.0.0.alpha2/lib/active_support/callbacks.rb:127
  ..... and more
'>Copy</button>
</div>
<p>Every frame comes with:</p>
<ul>
<li>Frame identifier</li>
<li>Call location</li>
<li>Additional information (e.g. block or method arguments)</li>
</ul>
<p>This will give you a great sense about what's happening in your app. However, you probably will notice that:</p>
<ul>
<li>There are too many frames (usually 50+ in a Rails app).</li>
<li>Most of the frames are from Rails or other libraries you use.</li>
</ul>
<p>Don't worry, the <code>backtrace</code> command provides 2 options to help you filter frames:</p>
<ul>
<li>
<code>backtrace [num]</code> - only show <code>num</code> numbers of frames, e.g. <code>backtrace 10</code> .</li>
<li>
<code>backtrace /pattern/</code> - only show frames with identifier or location that matches the pattern, e.g. <code>backtrace /MyModel/</code>.</li>
</ul>
<p>It's also possible to use these options together: <code>backtrace [num] /pattern/</code>.</p>

<h5 id="the-outline-command"><a class="anchorlink" href="#the-outline-command">3.2.3 The outline command</a></h5>

<p>This command is similar to <code>pry</code> and <code>irb</code>'s <code>ls</code> command. It will show you what's accessible from the current scope, including:</p>
<ul>
<li>Local variables</li>
<li>Instance variables</li>
<li>Class variables</li>
<li>Methods &amp; their sources</li>
</ul>
<div class="code_container">
<pre><code class="highlight rb"><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Configurable</span><span class="c1">#methods: config</span>
<span class="no">AbstractController</span><span class="o">::</span><span class="no">Base</span><span class="c1">#methods:</span>
  <span class="n">action_methods</span>  <span class="n">action_name</span>  <span class="n">action_name</span><span class="o">=</span>  <span class="n">available_action?</span>  <span class="n">controller_path</span>  <span class="nb">inspect</span>
  <span class="n">response_body</span>
<span class="no">ActionController</span><span class="o">::</span><span class="no">Metal</span><span class="c1">#methods:</span>
  <span class="n">content_type</span>       <span class="n">content_type</span><span class="o">=</span>  <span class="n">controller_name</span>  <span class="n">dispatch</span>          <span class="n">headers</span>
  <span class="n">location</span>           <span class="n">location</span><span class="o">=</span>      <span class="n">media_type</span>       <span class="n">middleware_stack</span>  <span class="n">middleware_stack</span><span class="o">=</span>
  <span class="n">middleware_stack?</span>  <span class="n">performed?</span>     <span class="n">request</span>          <span class="n">request</span><span class="o">=</span>          <span class="n">reset_session</span>
  <span class="n">response</span>           <span class="n">response</span><span class="o">=</span>      <span class="n">response_body</span><span class="o">=</span>   <span class="n">response_code</span>     <span class="n">session</span>
  <span class="n">set_request!</span>       <span class="n">set_response!</span>  <span class="n">status</span>           <span class="n">status</span><span class="o">=</span>           <span class="nb">to_a</span>
<span class="no">ActionView</span><span class="o">::</span><span class="no">ViewPaths</span><span class="c1">#methods:</span>
  <span class="n">_prefixes</span>  <span class="n">any_templates?</span>  <span class="n">append_view_path</span>   <span class="n">details_for_lookup</span>  <span class="n">formats</span>     <span class="n">formats</span><span class="o">=</span>  <span class="n">locale</span>
  <span class="n">locale</span><span class="o">=</span>    <span class="n">lookup_context</span>  <span class="n">prepend_view_path</span>  <span class="n">template_exists?</span>    <span class="n">view_paths</span>
<span class="no">AbstractController</span><span class="o">::</span><span class="no">Rendering</span><span class="c1">#methods: view_assigns</span>

<span class="c1"># .....</span>

<span class="no">PostsController</span><span class="c1">#methods: create  destroy  edit  index  new  show  update</span>
<span class="n">instance</span> <span class="ss">variables:
  </span><span class="vi">@_action_has_layout</span>  <span class="vi">@_action_name</span>    <span class="vi">@_config</span>  <span class="vi">@_lookup_context</span>                      <span class="vi">@_request</span>
  <span class="vi">@_response</span>           <span class="vi">@_response_body</span>  <span class="vi">@_routes</span>  <span class="vi">@marked_for_same_origin_verification</span>  <span class="vi">@posts</span>
  <span class="vi">@rendered_format</span>
<span class="k">class</span> <span class="ss">variables: </span><span class="vc">@@raise_on_missing_translations</span>  <span class="vc">@@raise_on_open_redirects</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="ActiveSupport::Configurable#methods: config
AbstractController::Base#methods:
  action_methods  action_name  action_name=  available_action?  controller_path  inspect
  response_body
ActionController::Metal#methods:
  content_type       content_type=  controller_name  dispatch          headers
  location           location=      media_type       middleware_stack  middleware_stack=
  middleware_stack?  performed?     request          request=          reset_session
  response           response=      response_body=   response_code     session
  set_request!       set_response!  status           status=           to_a
ActionView::ViewPaths#methods:
  _prefixes  any_templates?  append_view_path   details_for_lookup  formats     formats=  locale
  locale=    lookup_context  prepend_view_path  template_exists?    view_paths
AbstractController::Rendering#methods: view_assigns

# .....

PostsController#methods: create  destroy  edit  index  new  show  update
instance variables:
  @_action_has_layout  @_action_name    @_config  @_lookup_context                      @_request
  @_response           @_response_body  @_routes  @marked_for_same_origin_verification  @posts
  @rendered_format
class variables: @@raise_on_missing_translations  @@raise_on_open_redirects
">Copy</button>
</div>
<h4 id="breakpoints"><a class="anchorlink" href="#breakpoints">3.3 Breakpoints</a></h4>

<p>There are many ways to insert and trigger a breakpoint in the debugger. In addition to adding debugging statements (e.g. <code>debugger</code>) directly in your code, you can also insert breakpoints with commands:</p>
<ul>
<li>
<code>break</code> (or <code>b</code>)

<ul>
<li>
<code>break</code> - list all breakpoints</li>
<li>
<code>break &lt;num&gt;</code> - set a breakpoint on the <code>num</code> line of the current file</li>
<li>
<code>break &lt;file:num&gt;</code> - set a breakpoint on the <code>num</code> line of <code>file</code>
</li>
<li>
<code>break &lt;Class#method&gt;</code> or <code>break &lt;Class.method&gt;</code> - set a breakpoint on <code>Class#method</code> or <code>Class.method</code>
</li>
<li>
<code>break &lt;expr&gt;.&lt;method&gt;</code> - sets a breakpoint on <code>&lt;expr&gt;</code> result's <code>&lt;method&gt;</code> method.</li>
</ul>
</li>
<li>
<code>catch &lt;Exception&gt;</code> - set a breakpoint that'll stop when <code>Exception</code> is raised</li>
<li>
<code>watch &lt;@ivar&gt;</code> - set a breakpoint that'll stop when the result of current object's <code>@ivar</code> is changed (this is slow)</li>
</ul>
<p>And to remove them, you can use:</p>
<ul>
<li>
<code>delete</code> (or <code>del</code>)

<ul>
<li>
<code>delete</code> - delete all breakpoints</li>
<li>
<code>delete &lt;num&gt;</code> - delete the breakpoint with id <code>num</code>
</li>
</ul>
</li>
</ul>
<h5 id="the-break-command"><a class="anchorlink" href="#the-break-command">3.3.1 The break command</a></h5>

<p><strong>Set a breakpoint on a specified line number - e.g. <code>b 28</code></strong></p>

<div class="code_container">
<pre><code class="highlight rb"><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">29</span><span class="p">]</span> <span class="k">in</span> <span class="o">~</span><span class="sr">/projects/</span><span class="n">rails</span><span class="o">-</span><span class="n">guide</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">posts_controller</span><span class="p">.</span><span class="nf">rb</span>
    <span class="mi">20</span><span class="o">|</span>   <span class="k">end</span>
    <span class="mi">21</span><span class="o">|</span>
    <span class="mi">22</span><span class="o">|</span>   <span class="c1"># POST /posts or /posts.json</span>
    <span class="mi">23</span><span class="o">|</span>   <span class="k">def</span> <span class="nf">create</span>
    <span class="mi">24</span><span class="o">|</span>     <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">post_params</span><span class="p">)</span>
<span class="o">=&gt;</span>  <span class="mi">25</span><span class="o">|</span>     <span class="n">debugger</span>
    <span class="mi">26</span><span class="o">|</span>
    <span class="mi">27</span><span class="o">|</span>     <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
    <span class="mi">28</span><span class="o">|</span>       <span class="k">if</span> <span class="vi">@post</span><span class="p">.</span><span class="nf">save</span>
    <span class="mi">29</span><span class="o">|</span>         <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="vi">@post</span><span class="p">,</span> <span class="ss">notice: </span><span class="s2">"Post was successfully created."</span> <span class="p">}</span>
<span class="o">=&gt;</span><span class="c1">#0    PostsController#create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:25</span>
  <span class="c1">#1    ActionController::BasicImplicitRender#send_action(method="create", args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6</span>
  <span class="c1"># and 72 frames (use `bt' command for all frames)</span>
<span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="n">b</span> <span class="mi">28</span>    <span class="c1"># break command</span>
<span class="c1">#0  BP - Line  /Users/st0012/projects/rails-guide-example/app/controllers/posts_controller.rb:28 (line)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="[20, 29] in ~/projects/rails-guide-example/app/controllers/posts_controller.rb
    20|   end
    21|
    22|   # POST /posts or /posts.json
    23|   def create
    24|     @post = Post.new(post_params)
=&gt;  25|     debugger
    26|
    27|     respond_to do |format|
    28|       if @post.save
    29|         format.html { redirect_to @post, notice: &quot;Post was successfully created.&quot; }
=&gt;#0    PostsController#create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:25
  #1    ActionController::BasicImplicitRender#send_action(method=&quot;create&quot;, args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6
  # and 72 frames (use `bt' command for all frames)
(rdbg) b 28    # break command
#0  BP - Line  /Users/st0012/projects/rails-guide-example/app/controllers/posts_controller.rb:28 (line)
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight rb"><span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="n">c</span>    <span class="c1"># continue command</span>
<span class="p">[</span><span class="mi">23</span><span class="p">,</span> <span class="mi">32</span><span class="p">]</span> <span class="k">in</span> <span class="o">~</span><span class="sr">/projects/</span><span class="n">rails</span><span class="o">-</span><span class="n">guide</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">posts_controller</span><span class="p">.</span><span class="nf">rb</span>
    <span class="mi">23</span><span class="o">|</span>   <span class="k">def</span> <span class="nf">create</span>
    <span class="mi">24</span><span class="o">|</span>     <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">post_params</span><span class="p">)</span>
    <span class="mi">25</span><span class="o">|</span>     <span class="n">debugger</span>
    <span class="mi">26</span><span class="o">|</span>
    <span class="mi">27</span><span class="o">|</span>     <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
<span class="o">=&gt;</span>  <span class="mi">28</span><span class="o">|</span>       <span class="k">if</span> <span class="vi">@post</span><span class="p">.</span><span class="nf">save</span>
    <span class="mi">29</span><span class="o">|</span>         <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="vi">@post</span><span class="p">,</span> <span class="ss">notice: </span><span class="s2">"Post was successfully created."</span> <span class="p">}</span>
    <span class="mi">30</span><span class="o">|</span>         <span class="nb">format</span><span class="p">.</span><span class="nf">json</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">:show</span><span class="p">,</span> <span class="ss">status: :created</span><span class="p">,</span> <span class="ss">location: </span><span class="vi">@post</span> <span class="p">}</span>
    <span class="mi">31</span><span class="o">|</span>       <span class="k">else</span>
    <span class="mi">32</span><span class="o">|</span>         <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">:new</span><span class="p">,</span> <span class="ss">status: :unprocessable_entity</span> <span class="p">}</span>
<span class="o">=&gt;</span><span class="c1">#0    block {|format=#&lt;ActionController::MimeResponds::Collec...|} in create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:28</span>
  <span class="c1">#1    ActionController::MimeResponds#respond_to(mimes=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/mime_responds.rb:205</span>
  <span class="c1"># and 74 frames (use `bt' command for all frames)</span>

<span class="no">Stop</span> <span class="n">by</span> <span class="c1">#0  BP - Line  /Users/st0012/projects/rails-guide-example/app/controllers/posts_controller.rb:28 (line)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="(rdbg) c    # continue command
[23, 32] in ~/projects/rails-guide-example/app/controllers/posts_controller.rb
    23|   def create
    24|     @post = Post.new(post_params)
    25|     debugger
    26|
    27|     respond_to do |format|
=&gt;  28|       if @post.save
    29|         format.html { redirect_to @post, notice: &quot;Post was successfully created.&quot; }
    30|         format.json { render :show, status: :created, location: @post }
    31|       else
    32|         format.html { render :new, status: :unprocessable_entity }
=&gt;#0    block {|format=#&lt;ActionController::MimeResponds::Collec...|} in create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:28
  #1    ActionController::MimeResponds#respond_to(mimes=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/mime_responds.rb:205
  # and 74 frames (use `bt' command for all frames)

Stop by #0  BP - Line  /Users/st0012/projects/rails-guide-example/app/controllers/posts_controller.rb:28 (line)
">Copy</button>
</div>
<p><strong>Set a breakpoint on a given method call - e.g. <code>b @post.save</code></strong></p>

<div class="code_container">
<pre><code class="highlight rb"><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">29</span><span class="p">]</span> <span class="k">in</span> <span class="o">~</span><span class="sr">/projects/</span><span class="n">rails</span><span class="o">-</span><span class="n">guide</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">posts_controller</span><span class="p">.</span><span class="nf">rb</span>
    <span class="mi">20</span><span class="o">|</span>   <span class="k">end</span>
    <span class="mi">21</span><span class="o">|</span>
    <span class="mi">22</span><span class="o">|</span>   <span class="c1"># POST /posts or /posts.json</span>
    <span class="mi">23</span><span class="o">|</span>   <span class="k">def</span> <span class="nf">create</span>
    <span class="mi">24</span><span class="o">|</span>     <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">post_params</span><span class="p">)</span>
<span class="o">=&gt;</span>  <span class="mi">25</span><span class="o">|</span>     <span class="n">debugger</span>
    <span class="mi">26</span><span class="o">|</span>
    <span class="mi">27</span><span class="o">|</span>     <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
    <span class="mi">28</span><span class="o">|</span>       <span class="k">if</span> <span class="vi">@post</span><span class="p">.</span><span class="nf">save</span>
    <span class="mi">29</span><span class="o">|</span>         <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="vi">@post</span><span class="p">,</span> <span class="ss">notice: </span><span class="s2">"Post was successfully created."</span> <span class="p">}</span>
<span class="o">=&gt;</span><span class="c1">#0    PostsController#create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:25</span>
  <span class="c1">#1    ActionController::BasicImplicitRender#send_action(method="create", args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6</span>
  <span class="c1"># and 72 frames (use `bt' command for all frames)</span>
<span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="n">b</span> <span class="vi">@post</span><span class="p">.</span><span class="nf">save</span>    <span class="c1"># break command</span>
<span class="c1">#0  BP - Method  @post.save at /Users/st0012/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/suppressor.rb:43</span>

</code></pre>
<button class="clipboard-button" data-clipboard-text="[20, 29] in ~/projects/rails-guide-example/app/controllers/posts_controller.rb
    20|   end
    21|
    22|   # POST /posts or /posts.json
    23|   def create
    24|     @post = Post.new(post_params)
=&gt;  25|     debugger
    26|
    27|     respond_to do |format|
    28|       if @post.save
    29|         format.html { redirect_to @post, notice: &quot;Post was successfully created.&quot; }
=&gt;#0    PostsController#create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:25
  #1    ActionController::BasicImplicitRender#send_action(method=&quot;create&quot;, args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6
  # and 72 frames (use `bt' command for all frames)
(rdbg) b @post.save    # break command
#0  BP - Method  @post.save at /Users/st0012/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/suppressor.rb:43

">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight rb"><span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="n">c</span>    <span class="c1"># continue command</span>
<span class="p">[</span><span class="mi">39</span><span class="p">,</span> <span class="mi">48</span><span class="p">]</span> <span class="k">in</span> <span class="o">~</span><span class="sr">/.rbenv/</span><span class="n">versions</span><span class="o">/</span><span class="mf">3.0</span><span class="o">.</span><span class="mi">1</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ruby</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="mf">3.0</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">activerecord</span><span class="o">-</span><span class="mf">7.0</span><span class="o">.</span><span class="mi">0</span><span class="p">.</span><span class="nf">alpha2</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">active_record</span><span class="o">/</span><span class="n">suppressor</span><span class="p">.</span><span class="nf">rb</span>
    <span class="mi">39</span><span class="o">|</span>         <span class="no">SuppressorRegistry</span><span class="p">.</span><span class="nf">suppressed</span><span class="p">[</span><span class="nb">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">previous_state</span>
    <span class="mi">40</span><span class="o">|</span>       <span class="k">end</span>
    <span class="mi">41</span><span class="o">|</span>     <span class="k">end</span>
    <span class="mi">42</span><span class="o">|</span>
    <span class="mi">43</span><span class="o">|</span>     <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="o">**</span><span class="p">)</span> <span class="c1"># :nodoc:</span>
<span class="o">=&gt;</span>  <span class="mi">44</span><span class="o">|</span>       <span class="no">SuppressorRegistry</span><span class="p">.</span><span class="nf">suppressed</span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span><span class="p">]</span> <span class="p">?</span> <span class="kp">true</span> <span class="p">:</span> <span class="k">super</span>
    <span class="mi">45</span><span class="o">|</span>     <span class="k">end</span>
    <span class="mi">46</span><span class="o">|</span>
    <span class="mi">47</span><span class="o">|</span>     <span class="k">def</span> <span class="nf">save!</span><span class="p">(</span><span class="o">**</span><span class="p">)</span> <span class="c1"># :nodoc:</span>
    <span class="mi">48</span><span class="o">|</span>       <span class="no">SuppressorRegistry</span><span class="p">.</span><span class="nf">suppressed</span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span><span class="p">]</span> <span class="p">?</span> <span class="kp">true</span> <span class="p">:</span> <span class="k">super</span>
<span class="o">=&gt;</span><span class="c1">#0    ActiveRecord::Suppressor#save(#arg_rest=nil) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/suppressor.rb:44</span>
  <span class="c1">#1    block {|format=#&lt;ActionController::MimeResponds::Collec...|} in create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:28</span>
  <span class="c1"># and 75 frames (use `bt' command for all frames)</span>

<span class="no">Stop</span> <span class="n">by</span> <span class="c1">#0  BP - Method  @post.save at /Users/st0012/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/suppressor.rb:43</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="(rdbg) c    # continue command
[39, 48] in ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/suppressor.rb
    39|         SuppressorRegistry.suppressed[name] = previous_state
    40|       end
    41|     end
    42|
    43|     def save(**) # :nodoc:
=&gt;  44|       SuppressorRegistry.suppressed[self.class.name] ? true : super
    45|     end
    46|
    47|     def save!(**) # :nodoc:
    48|       SuppressorRegistry.suppressed[self.class.name] ? true : super
=&gt;#0    ActiveRecord::Suppressor#save(#arg_rest=nil) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/suppressor.rb:44
  #1    block {|format=#&lt;ActionController::MimeResponds::Collec...|} in create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:28
  # and 75 frames (use `bt' command for all frames)

Stop by #0  BP - Method  @post.save at /Users/st0012/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/suppressor.rb:43
">Copy</button>
</div>
<h5 id="the-catch-command"><a class="anchorlink" href="#the-catch-command">3.3.2 The catch command</a></h5>

<p><strong>Stop when an exception is raised - e.g. <code>catch ActiveRecord::RecordInvalid</code></strong></p>

<div class="code_container">
<pre><code class="highlight rb"><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">29</span><span class="p">]</span> <span class="k">in</span> <span class="o">~</span><span class="sr">/projects/</span><span class="n">rails</span><span class="o">-</span><span class="n">guide</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">posts_controller</span><span class="p">.</span><span class="nf">rb</span>
    <span class="mi">20</span><span class="o">|</span>   <span class="k">end</span>
    <span class="mi">21</span><span class="o">|</span>
    <span class="mi">22</span><span class="o">|</span>   <span class="c1"># POST /posts or /posts.json</span>
    <span class="mi">23</span><span class="o">|</span>   <span class="k">def</span> <span class="nf">create</span>
    <span class="mi">24</span><span class="o">|</span>     <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">post_params</span><span class="p">)</span>
<span class="o">=&gt;</span>  <span class="mi">25</span><span class="o">|</span>     <span class="n">debugger</span>
    <span class="mi">26</span><span class="o">|</span>
    <span class="mi">27</span><span class="o">|</span>     <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
    <span class="mi">28</span><span class="o">|</span>       <span class="k">if</span> <span class="vi">@post</span><span class="p">.</span><span class="nf">save!</span>
    <span class="mi">29</span><span class="o">|</span>         <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="vi">@post</span><span class="p">,</span> <span class="ss">notice: </span><span class="s2">"Post was successfully created."</span> <span class="p">}</span>
<span class="o">=&gt;</span><span class="c1">#0    PostsController#create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:25</span>
  <span class="c1">#1    ActionController::BasicImplicitRender#send_action(method="create", args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6</span>
  <span class="c1"># and 72 frames (use `bt' command for all frames)</span>
<span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="kp">catch</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">RecordInvalid</span>    <span class="c1"># command</span>
<span class="c1">#1  BP - Catch  "ActiveRecord::RecordInvalid"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="[20, 29] in ~/projects/rails-guide-example/app/controllers/posts_controller.rb
    20|   end
    21|
    22|   # POST /posts or /posts.json
    23|   def create
    24|     @post = Post.new(post_params)
=&gt;  25|     debugger
    26|
    27|     respond_to do |format|
    28|       if @post.save!
    29|         format.html { redirect_to @post, notice: &quot;Post was successfully created.&quot; }
=&gt;#0    PostsController#create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:25
  #1    ActionController::BasicImplicitRender#send_action(method=&quot;create&quot;, args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6
  # and 72 frames (use `bt' command for all frames)
(rdbg) catch ActiveRecord::RecordInvalid    # command
#1  BP - Catch  &quot;ActiveRecord::RecordInvalid&quot;
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight rb"><span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="n">c</span>    <span class="c1"># continue command</span>
<span class="p">[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">84</span><span class="p">]</span> <span class="k">in</span> <span class="o">~</span><span class="sr">/.rbenv/</span><span class="n">versions</span><span class="o">/</span><span class="mf">3.0</span><span class="o">.</span><span class="mi">1</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ruby</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="mf">3.0</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">activerecord</span><span class="o">-</span><span class="mf">7.0</span><span class="o">.</span><span class="mi">0</span><span class="p">.</span><span class="nf">alpha2</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">active_record</span><span class="o">/</span><span class="n">validations</span><span class="p">.</span><span class="nf">rb</span>
    <span class="mi">75</span><span class="o">|</span>     <span class="k">def</span> <span class="nf">default_validation_context</span>
    <span class="mi">76</span><span class="o">|</span>       <span class="n">new_record?</span> <span class="p">?</span> <span class="ss">:create</span> <span class="p">:</span> <span class="ss">:update</span>
    <span class="mi">77</span><span class="o">|</span>     <span class="k">end</span>
    <span class="mi">78</span><span class="o">|</span>
    <span class="mi">79</span><span class="o">|</span>     <span class="k">def</span> <span class="nf">raise_validation_error</span>
<span class="o">=&gt;</span>  <span class="mi">80</span><span class="o">|</span>       <span class="k">raise</span><span class="p">(</span><span class="no">RecordInvalid</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nb">self</span><span class="p">))</span>
    <span class="mi">81</span><span class="o">|</span>     <span class="k">end</span>
    <span class="mi">82</span><span class="o">|</span>
    <span class="mi">83</span><span class="o">|</span>     <span class="k">def</span> <span class="nf">perform_validations</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="p">{})</span>
    <span class="mi">84</span><span class="o">|</span>       <span class="n">options</span><span class="p">[</span><span class="ss">:validate</span><span class="p">]</span> <span class="o">==</span> <span class="kp">false</span> <span class="o">||</span> <span class="n">valid?</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="ss">:context</span><span class="p">])</span>
<span class="o">=&gt;</span><span class="c1">#0    ActiveRecord::Validations#raise_validation_error at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:80</span>
  <span class="c1">#1    ActiveRecord::Validations#save!(options={}) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:53</span>
  <span class="c1"># and 88 frames (use `bt' command for all frames)</span>

<span class="no">Stop</span> <span class="n">by</span> <span class="c1">#1  BP - Catch  "ActiveRecord::RecordInvalid"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="(rdbg) c    # continue command
[75, 84] in ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb
    75|     def default_validation_context
    76|       new_record? ? :create : :update
    77|     end
    78|
    79|     def raise_validation_error
=&gt;  80|       raise(RecordInvalid.new(self))
    81|     end
    82|
    83|     def perform_validations(options = {})
    84|       options[:validate] == false || valid?(options[:context])
=&gt;#0    ActiveRecord::Validations#raise_validation_error at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:80
  #1    ActiveRecord::Validations#save!(options={}) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:53
  # and 88 frames (use `bt' command for all frames)

Stop by #1  BP - Catch  &quot;ActiveRecord::RecordInvalid&quot;
">Copy</button>
</div>
<h5 id="the-watch-command"><a class="anchorlink" href="#the-watch-command">3.3.3 The watch command</a></h5>

<p><strong>Stop when the instance variable is changed - e.g. <code>watch @_response_body</code></strong></p>

<div class="code_container">
<pre><code class="highlight rb"><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">29</span><span class="p">]</span> <span class="k">in</span> <span class="o">~</span><span class="sr">/projects/</span><span class="n">rails</span><span class="o">-</span><span class="n">guide</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">posts_controller</span><span class="p">.</span><span class="nf">rb</span>
    <span class="mi">20</span><span class="o">|</span>   <span class="k">end</span>
    <span class="mi">21</span><span class="o">|</span>
    <span class="mi">22</span><span class="o">|</span>   <span class="c1"># POST /posts or /posts.json</span>
    <span class="mi">23</span><span class="o">|</span>   <span class="k">def</span> <span class="nf">create</span>
    <span class="mi">24</span><span class="o">|</span>     <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">post_params</span><span class="p">)</span>
<span class="o">=&gt;</span>  <span class="mi">25</span><span class="o">|</span>     <span class="n">debugger</span>
    <span class="mi">26</span><span class="o">|</span>
    <span class="mi">27</span><span class="o">|</span>     <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
    <span class="mi">28</span><span class="o">|</span>       <span class="k">if</span> <span class="vi">@post</span><span class="p">.</span><span class="nf">save!</span>
    <span class="mi">29</span><span class="o">|</span>         <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="vi">@post</span><span class="p">,</span> <span class="ss">notice: </span><span class="s2">"Post was successfully created."</span> <span class="p">}</span>
<span class="o">=&gt;</span><span class="c1">#0    PostsController#create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:25</span>
  <span class="c1">#1    ActionController::BasicImplicitRender#send_action(method="create", args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6</span>
  <span class="c1"># and 72 frames (use `bt' command for all frames)</span>
<span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="n">watch</span> <span class="vi">@_response_body</span>    <span class="c1"># command</span>
<span class="c1">#0  BP - Watch  #&lt;PostsController:0x00007fce69ca5320&gt; @_response_body =</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="[20, 29] in ~/projects/rails-guide-example/app/controllers/posts_controller.rb
    20|   end
    21|
    22|   # POST /posts or /posts.json
    23|   def create
    24|     @post = Post.new(post_params)
=&gt;  25|     debugger
    26|
    27|     respond_to do |format|
    28|       if @post.save!
    29|         format.html { redirect_to @post, notice: &quot;Post was successfully created.&quot; }
=&gt;#0    PostsController#create at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:25
  #1    ActionController::BasicImplicitRender#send_action(method=&quot;create&quot;, args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6
  # and 72 frames (use `bt' command for all frames)
(rdbg) watch @_response_body    # command
#0  BP - Watch  #&lt;PostsController:0x00007fce69ca5320&gt; @_response_body =
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight rb"><span class="p">(</span><span class="n">rdbg</span><span class="p">)</span> <span class="n">c</span>    <span class="c1"># continue command</span>
<span class="p">[</span><span class="mi">173</span><span class="p">,</span> <span class="mi">182</span><span class="p">]</span> <span class="k">in</span> <span class="o">~</span><span class="sr">/.rbenv/</span><span class="n">versions</span><span class="o">/</span><span class="mf">3.0</span><span class="o">.</span><span class="mi">1</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ruby</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="mf">3.0</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">actionpack</span><span class="o">-</span><span class="mf">7.0</span><span class="o">.</span><span class="mi">0</span><span class="p">.</span><span class="nf">alpha2</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">action_controller</span><span class="o">/</span><span class="n">metal</span><span class="p">.</span><span class="nf">rb</span>
   <span class="mi">173</span><span class="o">|</span>       <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="n">body</span><span class="p">]</span> <span class="k">unless</span> <span class="n">body</span><span class="p">.</span><span class="nf">nil?</span> <span class="o">||</span> <span class="n">body</span><span class="p">.</span><span class="nf">respond_to?</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span>
   <span class="mi">174</span><span class="o">|</span>       <span class="n">response</span><span class="p">.</span><span class="nf">reset_body!</span>
   <span class="mi">175</span><span class="o">|</span>       <span class="k">return</span> <span class="k">unless</span> <span class="n">body</span>
   <span class="mi">176</span><span class="o">|</span>       <span class="n">response</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">body</span>
   <span class="mi">177</span><span class="o">|</span>       <span class="k">super</span>
<span class="o">=&gt;</span> <span class="mi">178</span><span class="o">|</span>     <span class="k">end</span>
   <span class="mi">179</span><span class="o">|</span>
   <span class="mi">180</span><span class="o">|</span>     <span class="c1"># Tests if render or redirect has already happened.</span>
   <span class="mi">181</span><span class="o">|</span>     <span class="k">def</span> <span class="nf">performed?</span>
   <span class="mi">182</span><span class="o">|</span>       <span class="n">response_body</span> <span class="o">||</span> <span class="n">response</span><span class="p">.</span><span class="nf">committed?</span>
<span class="o">=&gt;</span><span class="c1">#0    ActionController::Metal#response_body=(body=["&lt;html&gt;&lt;body&gt;You are being &lt;a href=\"ht...) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal.rb:178 #=&gt; ["&lt;html&gt;&lt;body&gt;You are being &lt;a href=\"ht...</span>
  <span class="c1">#1    ActionController::Redirecting#redirect_to(options=#&lt;Post id: 13, title: "qweqwe", content:..., response_options={:allow_other_host=&gt;false}) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/redirecting.rb:74</span>
  <span class="c1"># and 82 frames (use `bt' command for all frames)</span>

<span class="no">Stop</span> <span class="n">by</span> <span class="c1">#0  BP - Watch  #&lt;PostsController:0x00007fce69ca5320&gt; @_response_body =  -&gt; ["&lt;html&gt;&lt;body&gt;You are being &lt;a href=\"http://localhost:3000/posts/13\"&gt;redirected&lt;/a&gt;.&lt;/body&gt;&lt;/html&gt;"]</span>
<span class="p">(</span><span class="n">rdbg</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="(rdbg) c    # continue command
[173, 182] in ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal.rb
   173|       body = [body] unless body.nil? || body.respond_to?(:each)
   174|       response.reset_body!
   175|       return unless body
   176|       response.body = body
   177|       super
=&gt; 178|     end
   179|
   180|     # Tests if render or redirect has already happened.
   181|     def performed?
   182|       response_body || response.committed?
=&gt;#0    ActionController::Metal#response_body=(body=[&quot;&lt;html&gt;&lt;body&gt;You are being &lt;a href=\&quot;ht...) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal.rb:178 #=&gt; [&quot;&lt;html&gt;&lt;body&gt;You are being &lt;a href=\&quot;ht...
  #1    ActionController::Redirecting#redirect_to(options=#&lt;Post id: 13, title: &quot;qweqwe&quot;, content:..., response_options={:allow_other_host=&gt;false}) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/redirecting.rb:74
  # and 82 frames (use `bt' command for all frames)

Stop by #0  BP - Watch  #&lt;PostsController:0x00007fce69ca5320&gt; @_response_body =  -&gt; [&quot;&lt;html&gt;&lt;body&gt;You are being &lt;a href=\&quot;http://localhost:3000/posts/13\&quot;&gt;redirected&lt;/a&gt;.&lt;/body&gt;&lt;/html&gt;&quot;]
(rdbg)
">Copy</button>
</div>
<h5 id="breakpoint-options"><a class="anchorlink" href="#breakpoint-options">3.3.4 Breakpoint options</a></h5>

<p>In addition to different types of breakpoints, you can also specify options to achieve more advanced debugging workflow. Currently, the debugger supports 4 options:</p>
<ul>
<li>
<code>do: &lt;cmd or expr&gt;</code> - when the breakpoint is triggered, execute the given command/expression and continue the program:

<ul>
<li>
<code>break Foo#bar do: bt</code> - when <code>Foo#bar</code> is called, print the stack frames</li>
</ul>
</li>
<li>
<code>pre: &lt;cmd or expr&gt;</code> - when the breakpoint is triggered, execute the given command/expression before stopping:

<ul>
<li>
<code>break Foo#bar pre: info</code> - when <code>Foo#bar</code> is called, print its surrounding variables before stopping.</li>
</ul>
</li>
<li>
<code>if: &lt;expr&gt;</code> - the breakpoint only stops if the result of <code>&lt;expr</code>&gt; is true:

<ul>
<li>
<code>break Post#save if: params[:debug]</code> - stops at <code>Post#save</code> if <code>params[:debug]</code> is also true</li>
</ul>
</li>
<li>
<code>path: &lt;path_regexp&gt;</code> - the breakpoint only stops if the event that triggers it (e.g. a method call) happens from the given path:

<ul>
<li>
<code>break Post#save if: app/services/a_service</code> - stops at <code>Post#save</code> if the method call happens at a method matches Ruby regexp <code>/app\/services\/a_service/</code>.</li>
</ul>
</li>
</ul>
<p>Please also note that the first 3 options: <code>do:</code>, <code>pre:</code> and <code>if:</code> are also available for the debug statements we mentioned earlier. For example:</p>

<div class="code_container">
<pre><code class="highlight rb"><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="k">in</span> <span class="o">~</span><span class="sr">/projects/</span><span class="n">rails</span><span class="o">-</span><span class="n">guide</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">posts_controller</span><span class="p">.</span><span class="nf">rb</span>
     <span class="mi">2</span><span class="o">|</span>   <span class="n">before_action</span> <span class="ss">:set_post</span><span class="p">,</span> <span class="ss">only: </span><span class="sx">%i[ show edit update destroy ]</span>
     <span class="mi">3</span><span class="o">|</span>
     <span class="mi">4</span><span class="o">|</span>   <span class="c1"># GET /posts or /posts.json</span>
     <span class="mi">5</span><span class="o">|</span>   <span class="k">def</span> <span class="nf">index</span>
     <span class="mi">6</span><span class="o">|</span>     <span class="vi">@posts</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">all</span>
<span class="o">=&gt;</span>   <span class="mi">7</span><span class="o">|</span>     <span class="n">debugger</span><span class="p">(</span><span class="ss">do: </span><span class="s2">"info"</span><span class="p">)</span>
     <span class="mi">8</span><span class="o">|</span>   <span class="k">end</span>
     <span class="mi">9</span><span class="o">|</span>
    <span class="mi">10</span><span class="o">|</span>   <span class="c1"># GET /posts/1 or /posts/1.json</span>
    <span class="mi">11</span><span class="o">|</span>   <span class="k">def</span> <span class="nf">show</span>
<span class="o">=&gt;</span><span class="c1">#0    PostsController#index at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:7</span>
  <span class="c1">#1    ActionController::BasicImplicitRender#send_action(method="index", args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6</span>
  <span class="c1"># and 72 frames (use `bt' command for all frames)</span>
<span class="p">(</span><span class="n">rdbg</span><span class="ss">:binding</span><span class="p">.</span><span class="nf">break</span><span class="p">)</span> <span class="n">info</span>
<span class="o">%</span><span class="nb">self</span> <span class="o">=</span> <span class="c1">#&lt;PostsController:0x00000000017480&gt;</span>
<span class="vi">@_action_has_layout</span> <span class="o">=</span> <span class="kp">true</span>
<span class="vi">@_action_name</span> <span class="o">=</span> <span class="s2">"index"</span>
<span class="vi">@_config</span> <span class="o">=</span> <span class="p">{}</span>
<span class="vi">@_lookup_context</span> <span class="o">=</span> <span class="c1">#&lt;ActionView::LookupContext:0x00007fce3ad336b8 @details_key=nil, @digest_cache=...</span>
<span class="vi">@_request</span> <span class="o">=</span> <span class="c1">#&lt;ActionDispatch::Request GET "http://localhost:3000/posts" for 127.0.0.1&gt;</span>
<span class="vi">@_response</span> <span class="o">=</span> <span class="c1">#&lt;ActionDispatch::Response:0x00007fce3ad397e8 @mon_data=#&lt;Monitor:0x00007fce3ad396a8&gt;...</span>
<span class="vi">@_response_body</span> <span class="o">=</span> <span class="kp">nil</span>
<span class="vi">@_routes</span> <span class="o">=</span> <span class="kp">nil</span>
<span class="vi">@marked_for_same_origin_verification</span> <span class="o">=</span> <span class="kp">true</span>
<span class="vi">@posts</span> <span class="o">=</span> <span class="c1">#&lt;ActiveRecord::Relation [#&lt;Post id: 2, title: "qweqwe", content: "qweqwe", created_at: "...</span>
<span class="vi">@rendered_format</span> <span class="o">=</span> <span class="kp">nil</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="[2, 11] in ~/projects/rails-guide-example/app/controllers/posts_controller.rb
     2|   before_action :set_post, only: %i[ show edit update destroy ]
     3|
     4|   # GET /posts or /posts.json
     5|   def index
     6|     @posts = Post.all
=&gt;   7|     debugger(do: &quot;info&quot;)
     8|   end
     9|
    10|   # GET /posts/1 or /posts/1.json
    11|   def show
=&gt;#0    PostsController#index at ~/projects/rails-guide-example/app/controllers/posts_controller.rb:7
  #1    ActionController::BasicImplicitRender#send_action(method=&quot;index&quot;, args=[]) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/actionpack-7.0.0.alpha2/lib/action_controller/metal/basic_implicit_render.rb:6
  # and 72 frames (use `bt' command for all frames)
(rdbg:binding.break) info
%self = #&lt;PostsController:0x00000000017480&gt;
@_action_has_layout = true
@_action_name = &quot;index&quot;
@_config = {}
@_lookup_context = #&lt;ActionView::LookupContext:0x00007fce3ad336b8 @details_key=nil, @digest_cache=...
@_request = #&lt;ActionDispatch::Request GET &quot;http://localhost:3000/posts&quot; for 127.0.0.1&gt;
@_response = #&lt;ActionDispatch::Response:0x00007fce3ad397e8 @mon_data=#&lt;Monitor:0x00007fce3ad396a8&gt;...
@_response_body = nil
@_routes = nil
@marked_for_same_origin_verification = true
@posts = #&lt;ActiveRecord::Relation [#&lt;Post id: 2, title: &quot;qweqwe&quot;, content: &quot;qweqwe&quot;, created_at: &quot;...
@rendered_format = nil
">Copy</button>
</div>
<h5 id="program-your-debugging-workflow"><a class="anchorlink" href="#program-your-debugging-workflow">3.3.5 Program your debugging workflow</a></h5>

<p>With those options, you can script your debugging workflow in one line like:</p>

<div class="code_container">
<pre><code class="highlight rb"><span class="k">def</span> <span class="nf">create</span>
  <span class="n">debugger</span><span class="p">(</span><span class="ss">do: </span><span class="s2">"catch ActiveRecord::RecordInvalid do: bt 10"</span><span class="p">)</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='def create
  debugger(do: "catch ActiveRecord::RecordInvalid do: bt 10")
  # ...
end
'>Copy</button>
</div>
<p>And then the debugger will run the scripted command and insert the catch breakpoint</p>

<div class="code_container">
<pre><code class="highlight rb"><span class="p">(</span><span class="n">rdbg</span><span class="ss">:binding</span><span class="p">.</span><span class="nf">break</span><span class="p">)</span> <span class="kp">catch</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">RecordInvalid</span> <span class="ss">do: </span><span class="n">bt</span> <span class="mi">10</span>
<span class="c1">#0  BP - Catch  "ActiveRecord::RecordInvalid"</span>
<span class="p">[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">84</span><span class="p">]</span> <span class="k">in</span> <span class="o">~</span><span class="sr">/.rbenv/</span><span class="n">versions</span><span class="o">/</span><span class="mf">3.0</span><span class="o">.</span><span class="mi">1</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ruby</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="mf">3.0</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">activerecord</span><span class="o">-</span><span class="mf">7.0</span><span class="o">.</span><span class="mi">0</span><span class="p">.</span><span class="nf">alpha2</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">active_record</span><span class="o">/</span><span class="n">validations</span><span class="p">.</span><span class="nf">rb</span>
    <span class="mi">75</span><span class="o">|</span>     <span class="k">def</span> <span class="nf">default_validation_context</span>
    <span class="mi">76</span><span class="o">|</span>       <span class="n">new_record?</span> <span class="p">?</span> <span class="ss">:create</span> <span class="p">:</span> <span class="ss">:update</span>
    <span class="mi">77</span><span class="o">|</span>     <span class="k">end</span>
    <span class="mi">78</span><span class="o">|</span>
    <span class="mi">79</span><span class="o">|</span>     <span class="k">def</span> <span class="nf">raise_validation_error</span>
<span class="o">=&gt;</span>  <span class="mi">80</span><span class="o">|</span>       <span class="k">raise</span><span class="p">(</span><span class="no">RecordInvalid</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nb">self</span><span class="p">))</span>
    <span class="mi">81</span><span class="o">|</span>     <span class="k">end</span>
    <span class="mi">82</span><span class="o">|</span>
    <span class="mi">83</span><span class="o">|</span>     <span class="k">def</span> <span class="nf">perform_validations</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="p">{})</span>
    <span class="mi">84</span><span class="o">|</span>       <span class="n">options</span><span class="p">[</span><span class="ss">:validate</span><span class="p">]</span> <span class="o">==</span> <span class="kp">false</span> <span class="o">||</span> <span class="n">valid?</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="ss">:context</span><span class="p">])</span>
<span class="o">=&gt;</span><span class="c1">#0    ActiveRecord::Validations#raise_validation_error at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:80</span>
  <span class="c1">#1    ActiveRecord::Validations#save!(options={}) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:53</span>
  <span class="c1"># and 88 frames (use `bt' command for all frames)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="(rdbg:binding.break) catch ActiveRecord::RecordInvalid do: bt 10
#0  BP - Catch  &quot;ActiveRecord::RecordInvalid&quot;
[75, 84] in ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb
    75|     def default_validation_context
    76|       new_record? ? :create : :update
    77|     end
    78|
    79|     def raise_validation_error
=&gt;  80|       raise(RecordInvalid.new(self))
    81|     end
    82|
    83|     def perform_validations(options = {})
    84|       options[:validate] == false || valid?(options[:context])
=&gt;#0    ActiveRecord::Validations#raise_validation_error at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:80
  #1    ActiveRecord::Validations#save!(options={}) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:53
  # and 88 frames (use `bt' command for all frames)
">Copy</button>
</div>
<p>Once the catch breakpoint is triggered, it'll print the stack frames</p>

<div class="code_container">
<pre><code class="highlight rb"><span class="no">Stop</span> <span class="n">by</span> <span class="c1">#0  BP - Catch  "ActiveRecord::RecordInvalid"</span>

<span class="p">(</span><span class="n">rdbg</span><span class="ss">:catch</span><span class="p">)</span> <span class="n">bt</span> <span class="mi">10</span>
<span class="o">=&gt;</span><span class="c1">#0    ActiveRecord::Validations#raise_validation_error at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:80</span>
  <span class="c1">#1    ActiveRecord::Validations#save!(options={}) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:53</span>
  <span class="c1">#2    block in save! at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/transactions.rb:302</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='Stop by #0  BP - Catch  "ActiveRecord::RecordInvalid"

(rdbg:catch) bt 10
=&gt;#0    ActiveRecord::Validations#raise_validation_error at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:80
  #1    ActiveRecord::Validations#save!(options={}) at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/validations.rb:53
  #2    block in save! at ~/.rbenv/versions/3.0.1/lib/ruby/gems/3.0.0/gems/activerecord-7.0.0.alpha2/lib/active_record/transactions.rb:302
'>Copy</button>
</div>
<p>This technique can save you from repeated manual input and make the debugging experience smoother.</p>

<p>You can find more commands and configuration options from its <a href="https://github.com/ruby/debug">documentation</a>.</p>

<h5 id="autoloading-caveat"><a class="anchorlink" href="#autoloading-caveat">3.3.6 Autoloading Caveat</a></h5>

<p>Debugging with <code>debug</code> works fine most of the time, but there's an edge case: If you evaluate an expression in the console that autoloads a namespace defined in a file, constants in that namespace won't be found.</p>

<p>For example, if the application has these two files:</p>

<div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># hotel.rb</span>
<span class="k">class</span> <span class="nc">Hotel</span>
<span class="k">end</span>

<span class="c1"># hotel/pricing.rb</span>
<span class="k">module</span> <span class="nn">Hotel::Pricing</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="# hotel.rb
class Hotel
end

# hotel/pricing.rb
module Hotel::Pricing
end
">Copy</button>
</div>
<p>and <code>Hotel</code> is not yet loaded, then</p>

<div class="code_container">
<pre><code class="highlight plaintext">(rdbg) p Hotel::Pricing
</code></pre>
<button class="clipboard-button" data-clipboard-text="(rdbg) p Hotel::Pricing
">Copy</button>
</div>
<p>will raise a <code>NameError</code>. In some cases, Ruby will be able to resolve an unintended constant in a different scope.</p>

<p>If you hit this, please restart your debugging session with eager loading enabled (<code>config.eager_load = true</code>).</p>

<p>Stepping commands line <code>next</code>, <code>continue</code>, etc., do not present this issue. Namespaces defined implicitly only by
subdirectories are not subject to this issue either.</p>

<p>See <a href="https://github.com/ruby/debug/issues/408">ruby/debug#408</a> for details.</p>
</body>
</html>
