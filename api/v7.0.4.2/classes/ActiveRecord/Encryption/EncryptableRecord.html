<!DOCTYPE html>
<html lang="en">
<head>
    <title>ActiveRecord::Encryption::EncryptableRecord</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/panel.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/github.css" type="text/css" media="screen" />
<script src="../../../js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/turbolinks.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/search_index.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/searcher.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../panel/tree.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/searchdoc.js" type="text/javascript" charset="utf-8"></script>
<meta name="data-rel-prefix" content="../../../">
<meta name="data-tree-keys" content='["ActiveRecord", "Encryption", "EncryptableRecord"]'>


    <meta property="og:title" value="ActiveRecord::Encryption::EncryptableRecord">

  
    
    <meta name="description" content="This is the concern mixed in Active Record models to make them encryptable. It adds the encrypts attribute declaration, as well as the API to encrypt and decrypt records.">
    <meta property="og:description" content="This is the concern mixed in Active Record models to make them encryptable. It adds the encrypts attribute declaration, as well as the API to encrypt and decrypt records.">
  

    <meta name="keywords" content="ActiveRecord::Encryption::EncryptableRecord class, encrypts, deterministic_encrypted_attributes, source_attribute_from_preserved_attribute, scheme_for, global_previous_schemes_for, encrypt_attribute, preserve_original_encrypted, override_accessors_to_preserve_original, load_schema!, add_length_validation_for_encrypted_columns, validate_column_size, encrypted_attribute?, ciphertext_for, encrypt, decrypt">
</head>

<body>
    <a class="sr-only sr-only-focusable" href="#content" data-turbolinks="false">Skip to Content</a>
    <a class="sr-only sr-only-focusable" href="#search" data-turbolinks="false">Skip to Search</a>

    <input type="checkbox" id="hamburger" class="panel_checkbox">
<label class="panel_mobile_button" for="hamburger"><span></span> Menu</label>
<nav class="panel panel_tree" id="panel" data-turbolinks-permanent>
  <div class="header">
    <input type="text" placeholder="Search (/) for a class, method, ..." autosave="searchdoc" results="10" id="search" autocomplete="off" tabindex="-1" />
    <label class="panel_mobile_button_close" for="hamburger"><span></span> Close</label>
  </div>
  <div class="tree">
    <ul>
    </ul>
  </div>
  <div class="result">
    <ul>
    </ul>
  </div>
  <a href="links.html" id="links">index</a>
</nav>


    <div class="banner">
        
            <span>Ruby on Rails 7.0.4.2</span><br />
        
        <h2>
            <span class="type">Module</span>
            ActiveRecord::Encryption::EncryptableRecord
            
        </h2>
        <ul class="files">
            
            <li><a href="../../../files/activerecord/lib/active_record/encryption/encryptable_record_rb.html">activerecord/lib/active_record/encryption/encryptable_record.rb</a></li>
            
        </ul>
    </div>

    <main id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>This is the concern mixed in Active Record models to make them encryptable. It adds the <code>encrypts</code> attribute declaration, as well as the API to encrypt and decrypt records.</p>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>A</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-add_length_validation_for_encrypted_columns">add_length_validation_for_encrypted_columns</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-ciphertext_for">ciphertext_for</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>D</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-decrypt">decrypt</a>,
              </li>
            
              
              <li>
                <a href="#method-i-deterministic_encrypted_attributes">deterministic_encrypted_attributes</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>E</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-encrypt">encrypt</a>,
              </li>
            
              
              <li>
                <a href="#method-i-encrypt_attribute">encrypt_attribute</a>,
              </li>
            
              
              <li>
                <a href="#method-i-encrypted_attribute-3F">encrypted_attribute?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-encrypts">encrypts</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>G</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-global_previous_schemes_for">global_previous_schemes_for</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>L</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-load_schema-21">load_schema!</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>O</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-override_accessors_to_preserve_original">override_accessors_to_preserve_original</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>P</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-preserve_original_encrypted">preserve_original_encrypted</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-scheme_for">scheme_for</a>,
              </li>
            
              
              <li>
                <a href="#method-i-source_attribute_from_preserved_attribute">source_attribute_from_preserved_attribute</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>V</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-validate_column_size">validate_column_size</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    
      <!-- Section constants -->
      <h2 class="sectiontitle">Constants</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">ORIGINAL_ATTRIBUTE_PREFIX</td>
            <td>=</td>
            <td class="attr-value">&quot;original_&quot;</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
      </table>
    


    


    <!-- Methods -->
    
    
      <h2 class="sectiontitle">Instance Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-i-add_length_validation_for_encrypted_columns">
            
              <b>add_length_validation_for_encrypted_columns</b>()
            
            <a href="../../../classes/ActiveRecord/Encryption/EncryptableRecord.html#method-i-add_length_validation_for_encrypted_columns" name="method-i-add_length_validation_for_encrypted_columns" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-add_length_validation_for_encrypted_columns_source')" id="l_method-i-add_length_validation_for_encrypted_columns_source">show</a>
                

                 | 

                
                  <a href="https://github.com/rails/rails/blob/7c70791470fc517deb7c640bead9f1b47efb5539/activerecord/lib/active_record/encryption/encryptable_record.rb#L127" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-add_length_validation_for_encrypted_columns_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 127</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_length_validation_for_encrypted_columns</span>
  <span class="ruby-identifier">encrypted_attributes</span>&amp;.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">attribute_name</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">validate_column_size</span> <span class="ruby-identifier">attribute_name</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-ciphertext_for">
            
              <b>ciphertext_for</b>(attribute_name)
            
            <a href="../../../classes/ActiveRecord/Encryption/EncryptableRecord.html#method-i-ciphertext_for" name="method-i-ciphertext_for" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns the ciphertext for <code>attribute_name</code>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-ciphertext_for_source')" id="l_method-i-ciphertext_for_source">show</a>
                

                 | 

                
                  <a href="https://github.com/rails/rails/blob/7c70791470fc517deb7c640bead9f1b47efb5539/activerecord/lib/active_record/encryption/encryptable_record.rb#L146" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-ciphertext_for_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 146</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">ciphertext_for</span>(<span class="ruby-identifier">attribute_name</span>)
  <span class="ruby-identifier">read_attribute_before_type_cast</span>(<span class="ruby-identifier">attribute_name</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-decrypt">
            
              <b>decrypt</b>()
            
            <a href="../../../classes/ActiveRecord/Encryption/EncryptableRecord.html#method-i-decrypt" name="method-i-decrypt" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Decrypts all the encryptable attributes and saves the changes.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-decrypt_source')" id="l_method-i-decrypt_source">show</a>
                

                 | 

                
                  <a href="https://github.com/rails/rails/blob/7c70791470fc517deb7c640bead9f1b47efb5539/activerecord/lib/active_record/encryption/encryptable_record.rb#L156" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-decrypt_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 156</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">decrypt</span>
  <span class="ruby-identifier">decrypt_attributes</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_encrypted_attributes?</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-deterministic_encrypted_attributes">
            
              <b>deterministic_encrypted_attributes</b>()
            
            <a href="../../../classes/ActiveRecord/Encryption/EncryptableRecord.html#method-i-deterministic_encrypted_attributes" name="method-i-deterministic_encrypted_attributes" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns the list of deterministic encryptable attributes in the model class.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-deterministic_encrypted_attributes_source')" id="l_method-i-deterministic_encrypted_attributes_source">show</a>
                

                 | 

                
                  <a href="https://github.com/rails/rails/blob/7c70791470fc517deb7c640bead9f1b47efb5539/activerecord/lib/active_record/encryption/encryptable_record.rb#L56" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-deterministic_encrypted_attributes_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 56</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">deterministic_encrypted_attributes</span>
  <span class="ruby-ivar">@deterministic_encrypted_attributes</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">encrypted_attributes</span>&amp;.<span class="ruby-identifier">find_all</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">attribute_name</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">type_for_attribute</span>(<span class="ruby-identifier">attribute_name</span>).<span class="ruby-identifier">deterministic?</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-encrypt">
            
              <b>encrypt</b>()
            
            <a href="../../../classes/ActiveRecord/Encryption/EncryptableRecord.html#method-i-encrypt" name="method-i-encrypt" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Encrypts all the encryptable attributes and saves the changes.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-encrypt_source')" id="l_method-i-encrypt_source">show</a>
                

                 | 

                
                  <a href="https://github.com/rails/rails/blob/7c70791470fc517deb7c640bead9f1b47efb5539/activerecord/lib/active_record/encryption/encryptable_record.rb#L151" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-encrypt_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 151</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">encrypt</span>
  <span class="ruby-identifier">encrypt_attributes</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_encrypted_attributes?</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-encrypt_attribute">
            
              <b>encrypt_attribute</b>(name, attribute_scheme)
            
            <a href="../../../classes/ActiveRecord/Encryption/EncryptableRecord.html#method-i-encrypt_attribute" name="method-i-encrypt_attribute" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-encrypt_attribute_source')" id="l_method-i-encrypt_attribute_source">show</a>
                

                 | 

                
                  <a href="https://github.com/rails/rails/blob/7c70791470fc517deb7c640bead9f1b47efb5539/activerecord/lib/active_record/encryption/encryptable_record.rb#L82" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-encrypt_attribute_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 82</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">encrypt_attribute</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">attribute_scheme</span>)
  <span class="ruby-identifier">encrypted_attributes</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_sym</span>

  <span class="ruby-identifier">attribute</span> <span class="ruby-identifier">name</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cast_type</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">EncryptedAttributeType</span>.<span class="ruby-identifier">new</span> <span class="ruby-value">scheme:</span> <span class="ruby-identifier">attribute_scheme</span>, <span class="ruby-value">cast_type:</span> <span class="ruby-identifier">cast_type</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">preserve_original_encrypted</span>(<span class="ruby-identifier">name</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">attribute_scheme</span>.<span class="ruby-identifier">ignore_case?</span>
  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Encryption</span>.<span class="ruby-identifier">encrypted_attribute_was_declared</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">name</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-encrypted_attribute-3F">
            
              <b>encrypted_attribute?</b>(attribute_name)
            
            <a href="../../../classes/ActiveRecord/Encryption/EncryptableRecord.html#method-i-encrypted_attribute-3F" name="method-i-encrypted_attribute-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns whether a given attribute is encrypted or not.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-encrypted_attribute-3F_source')" id="l_method-i-encrypted_attribute-3F_source">show</a>
                

                 | 

                
                  <a href="https://github.com/rails/rails/blob/7c70791470fc517deb7c640bead9f1b47efb5539/activerecord/lib/active_record/encryption/encryptable_record.rb#L141" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-encrypted_attribute-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 141</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">encrypted_attribute?</span>(<span class="ruby-identifier">attribute_name</span>)
  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Encryption</span>.<span class="ruby-identifier">encryptor</span>.<span class="ruby-identifier">encrypted?</span> <span class="ruby-identifier">ciphertext_for</span>(<span class="ruby-identifier">attribute_name</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-encrypts">
            
              <b>encrypts</b>(*names, key_provider: nil, key: nil, deterministic: false, downcase: false, ignore_case: false, previous: [], **context_properties)
            
            <a href="../../../classes/ActiveRecord/Encryption/EncryptableRecord.html#method-i-encrypts" name="method-i-encrypts" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Encrypts the <code>name</code> attribute.</p>

<h3 id="method-i-encrypts-label-Options">Options</h3>
<ul><li>
<p><code>:key_provider</code> - A key provider to provide encryption and decryption keys. Defaults to <code>ActiveRecord::Encryption.key_provider</code>.</p>
</li><li>
<p><code>:key</code> - A password to derive the key from. It&#39;s a shorthand for a <code>:key_provider</code> that serves derivated keys. Both options can&#39;t be used at the same time.</p>
</li><li>
<p><code>:deterministic</code> - By default, encryption is not deterministic. It will use a random initialization vector for each encryption operation. This means that encrypting the same content with the same key twice will generate different ciphertexts. When set to <code>true</code>, it will generate the initialization vector based on the encrypted content. This means that the same content will generate the same ciphertexts. This enables querying encrypted text with Active Record. Deterministic encryption will use the oldest encryption scheme to encrypt new data by default. You can change this by setting +deterministic: { fixed: false }+. That will make it use the newest encryption scheme for encrypting new data.</p>
</li><li>
<p><code>:downcase</code> - When true, it converts the encrypted content to downcase automatically. This allows to effectively ignore case when querying data. Notice that the case is lost. Use <code>:ignore_case</code> if you are interested in preserving it.</p>
</li><li>
<p><code>:ignore_case</code> - When true, it behaves like <code>:downcase</code> but, it also preserves the original case in a specially designated column +original_&lt;name&gt;+. When reading the encrypted content, the version with the original case is served. But you can still execute queries that will ignore the case. This option can only be used when <code>:deterministic</code> is true.</p>
</li><li>
<p><code>:context_properties</code> - Additional properties that will override <code>Context</code> settings when this attribute is encrypted and decrypted. E.g: <code>encryptor:</code>, <code>cipher:</code>, <code>message_serializer:</code>, etc.</p>
</li><li>
<p><code>:previous</code> - List of previous encryption schemes. When provided, they will be used in order when trying to read the attribute. Each entry of the list can contain the properties supported by <a href="EncryptableRecord.html#method-i-encrypts"><code>encrypts</code></a>. Also, when deterministic encryption is used, they will be used to generate additional ciphertexts to check in the queries.</p>
</li></ul>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-encrypts_source')" id="l_method-i-encrypts_source">show</a>
                

                 | 

                
                  <a href="https://github.com/rails/rails/blob/7c70791470fc517deb7c640bead9f1b47efb5539/activerecord/lib/active_record/encryption/encryptable_record.rb#L45" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-encrypts_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 45</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">encrypts</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">names</span>, <span class="ruby-value">key_provider:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">key:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">deterministic:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">downcase:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">ignore_case:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">previous:</span> [], <span class="ruby-operator">**</span><span class="ruby-identifier">context_properties</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">encrypted_attributes</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Set</span>.<span class="ruby-identifier">new</span> <span class="ruby-comment"># not using :default because the instance would be shared across classes</span>
  <span class="ruby-identifier">scheme</span> = <span class="ruby-identifier">scheme_for</span> <span class="ruby-value">key_provider:</span> <span class="ruby-identifier">key_provider</span>, <span class="ruby-value">key:</span> <span class="ruby-identifier">key</span>, <span class="ruby-value">deterministic:</span> <span class="ruby-identifier">deterministic</span>, <span class="ruby-value">downcase:</span> <span class="ruby-identifier">downcase</span>, \
      <span class="ruby-value">ignore_case:</span> <span class="ruby-identifier">ignore_case</span>, <span class="ruby-value">previous:</span> <span class="ruby-identifier">previous</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">context_properties</span>

  <span class="ruby-identifier">names</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">encrypt_attribute</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">scheme</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-global_previous_schemes_for">
            
              <b>global_previous_schemes_for</b>(scheme)
            
            <a href="../../../classes/ActiveRecord/Encryption/EncryptableRecord.html#method-i-global_previous_schemes_for" name="method-i-global_previous_schemes_for" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-global_previous_schemes_for_source')" id="l_method-i-global_previous_schemes_for_source">show</a>
                

                 | 

                
                  <a href="https://github.com/rails/rails/blob/7c70791470fc517deb7c640bead9f1b47efb5539/activerecord/lib/active_record/encryption/encryptable_record.rb#L76" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-global_previous_schemes_for_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 76</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">global_previous_schemes_for</span>(<span class="ruby-identifier">scheme</span>)
  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Encryption</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">previous_schemes</span>.<span class="ruby-identifier">collect</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">previous_scheme</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">scheme</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">previous_scheme</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-load_schema-21">
            
              <b>load_schema!</b>()
            
            <a href="../../../classes/ActiveRecord/Encryption/EncryptableRecord.html#method-i-load_schema-21" name="method-i-load_schema-21" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-load_schema-21_source')" id="l_method-i-load_schema-21_source">show</a>
                

                 | 

                
                  <a href="https://github.com/rails/rails/blob/7c70791470fc517deb7c640bead9f1b47efb5539/activerecord/lib/active_record/encryption/encryptable_record.rb#L121" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-load_schema-21_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 121</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">load_schema!</span>
  <span class="ruby-keyword">super</span>

  <span class="ruby-identifier">add_length_validation_for_encrypted_columns</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Encryption</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">validate_column_size</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-override_accessors_to_preserve_original">
            
              <b>override_accessors_to_preserve_original</b>(name, original_attribute_name)
            
            <a href="../../../classes/ActiveRecord/Encryption/EncryptableRecord.html#method-i-override_accessors_to_preserve_original" name="method-i-override_accessors_to_preserve_original" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-override_accessors_to_preserve_original_source')" id="l_method-i-override_accessors_to_preserve_original_source">show</a>
                

                 | 

                
                  <a href="https://github.com/rails/rails/blob/7c70791470fc517deb7c640bead9f1b47efb5539/activerecord/lib/active_record/encryption/encryptable_record.rb#L104" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-override_accessors_to_preserve_original_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 104</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">override_accessors_to_preserve_original</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">original_attribute_name</span>)
  <span class="ruby-identifier">include</span>(<span class="ruby-constant">Module</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">define_method</span> <span class="ruby-identifier">name</span> <span class="ruby-keyword">do</span>
      <span class="ruby-keyword">if</span> ((<span class="ruby-identifier">value</span> = <span class="ruby-keyword">super</span>()) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">encrypted_attribute?</span>(<span class="ruby-identifier">name</span>)) <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Encryption</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">support_unencrypted_data</span>
        <span class="ruby-identifier">send</span>(<span class="ruby-identifier">original_attribute_name</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">value</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">define_method</span> <span class="ruby-node">&quot;#{name}=&quot;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">send</span> <span class="ruby-node">&quot;#{original_attribute_name}=&quot;</span>, <span class="ruby-identifier">value</span>
      <span class="ruby-keyword">super</span>(<span class="ruby-identifier">value</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-preserve_original_encrypted">
            
              <b>preserve_original_encrypted</b>(name)
            
            <a href="../../../classes/ActiveRecord/Encryption/EncryptableRecord.html#method-i-preserve_original_encrypted" name="method-i-preserve_original_encrypted" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-preserve_original_encrypted_source')" id="l_method-i-preserve_original_encrypted_source">show</a>
                

                 | 

                
                  <a href="https://github.com/rails/rails/blob/7c70791470fc517deb7c640bead9f1b47efb5539/activerecord/lib/active_record/encryption/encryptable_record.rb#L93" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-preserve_original_encrypted_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 93</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">preserve_original_encrypted</span>(<span class="ruby-identifier">name</span>)
  <span class="ruby-identifier">original_attribute_name</span> = <span class="ruby-node">&quot;#{ORIGINAL_ATTRIBUTE_PREFIX}#{name}&quot;</span>.<span class="ruby-identifier">to_sym</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Encryption</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">support_unencrypted_data</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">column_names</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">original_attribute_name</span>.<span class="ruby-identifier">to_s</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Errors</span><span class="ruby-operator">::</span><span class="ruby-constant">Configuration</span>, <span class="ruby-node">&quot;To use :ignore_case for &#39;#{name}&#39; you must create an additional column named &#39;#{original_attribute_name}&#39;&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">encrypts</span> <span class="ruby-identifier">original_attribute_name</span>
  <span class="ruby-identifier">override_accessors_to_preserve_original</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">original_attribute_name</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-scheme_for">
            
              <b>scheme_for</b>(key_provider: nil, key: nil, deterministic: false, downcase: false, ignore_case: false, previous: [], **context_properties)
            
            <a href="../../../classes/ActiveRecord/Encryption/EncryptableRecord.html#method-i-scheme_for" name="method-i-scheme_for" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-scheme_for_source')" id="l_method-i-scheme_for_source">show</a>
                

                 | 

                
                  <a href="https://github.com/rails/rails/blob/7c70791470fc517deb7c640bead9f1b47efb5539/activerecord/lib/active_record/encryption/encryptable_record.rb#L68" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-scheme_for_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 68</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">scheme_for</span>(<span class="ruby-value">key_provider:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">key:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">deterministic:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">downcase:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">ignore_case:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">previous:</span> [], <span class="ruby-operator">**</span><span class="ruby-identifier">context_properties</span>)
  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">Scheme</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">key_provider:</span> <span class="ruby-identifier">key_provider</span>, <span class="ruby-value">key:</span> <span class="ruby-identifier">key</span>, <span class="ruby-value">deterministic:</span> <span class="ruby-identifier">deterministic</span>,
                                       <span class="ruby-value">downcase:</span> <span class="ruby-identifier">downcase</span>, <span class="ruby-value">ignore_case:</span> <span class="ruby-identifier">ignore_case</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">context_properties</span>).<span class="ruby-identifier">tap</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">scheme</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">scheme</span>.<span class="ruby-identifier">previous_schemes</span> = <span class="ruby-identifier">global_previous_schemes_for</span>(<span class="ruby-identifier">scheme</span>) <span class="ruby-operator">+</span>
      <span class="ruby-constant">Array</span>.<span class="ruby-identifier">wrap</span>(<span class="ruby-identifier">previous</span>).<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">scheme_config</span><span class="ruby-operator">|</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">Scheme</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">**</span><span class="ruby-identifier">scheme_config</span>) }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-source_attribute_from_preserved_attribute">
            
              <b>source_attribute_from_preserved_attribute</b>(attribute_name)
            
            <a href="../../../classes/ActiveRecord/Encryption/EncryptableRecord.html#method-i-source_attribute_from_preserved_attribute" name="method-i-source_attribute_from_preserved_attribute" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Given a attribute name, it returns the name of the source attribute when it&#39;s a preserved one.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-source_attribute_from_preserved_attribute_source')" id="l_method-i-source_attribute_from_preserved_attribute_source">show</a>
                

                 | 

                
                  <a href="https://github.com/rails/rails/blob/7c70791470fc517deb7c640bead9f1b47efb5539/activerecord/lib/active_record/encryption/encryptable_record.rb#L63" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-source_attribute_from_preserved_attribute_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 63</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">source_attribute_from_preserved_attribute</span>(<span class="ruby-identifier">attribute_name</span>)
  <span class="ruby-identifier">attribute_name</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-constant">ORIGINAL_ATTRIBUTE_PREFIX</span>, <span class="ruby-string">&quot;&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-regexp">/^#{ORIGINAL_ATTRIBUTE_PREFIX}/</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-identifier">attribute_name</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-validate_column_size">
            
              <b>validate_column_size</b>(attribute_name)
            
            <a href="../../../classes/ActiveRecord/Encryption/EncryptableRecord.html#method-i-validate_column_size" name="method-i-validate_column_size" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                 Source: 

                
                  <a href="javascript:toggleSource('method-i-validate_column_size_source')" id="l_method-i-validate_column_size_source">show</a>
                

                 | 

                
                  <a href="https://github.com/rails/rails/blob/7c70791470fc517deb7c640bead9f1b47efb5539/activerecord/lib/active_record/encryption/encryptable_record.rb#L133" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-validate_column_size_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/encryption/encryptable_record.rb, line 133</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">validate_column_size</span>(<span class="ruby-identifier">attribute_name</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">limit</span> = <span class="ruby-identifier">columns_hash</span>[<span class="ruby-identifier">attribute_name</span>.<span class="ruby-identifier">to_s</span>]&amp;.<span class="ruby-identifier">limit</span>
    <span class="ruby-identifier">validates_length_of</span> <span class="ruby-identifier">attribute_name</span>, <span class="ruby-value">maximum:</span> <span class="ruby-identifier">limit</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </main>
  </body>
</html>
